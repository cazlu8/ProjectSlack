{"version":3,"sources":["scope.js"],"names":[],"mappings":"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","file":"scope-compiled.js","sourcesContent":["// Generated by CoffeeScript 1.3.3\n(function() {\n  var Scope, extend, last, _ref;\n\n  _ref = require('./helpers'), extend = _ref.extend, last = _ref.last;\n\n  exports.Scope = Scope = (function() {\n\n    Scope.root = null;\n\n    function Scope(parent, expressions, method) {\n      this.parent = parent;\n      this.expressions = expressions;\n      this.method = method;\n      this.variables = [\n        {\n          name: 'arguments',\n          type: 'arguments'\n        }\n      ];\n      this.positions = {};\n      if (!this.parent) {\n        Scope.root = this;\n      }\n    }\n\n    Scope.prototype.add = function(name, type, immediate) {\n      if (this.shared && !immediate) {\n        return this.parent.add(name, type, immediate);\n      }\n      if (Object.prototype.hasOwnProperty.call(this.positions, name)) {\n        return this.variables[this.positions[name]].type = type;\n      } else {\n        return this.positions[name] = this.variables.push({\n          name: name,\n          type: type\n        }) - 1;\n      }\n    };\n\n    Scope.prototype.namedMethod = function() {\n      if (this.method.name || !this.parent) {\n        return this.method;\n      }\n      return this.parent.namedMethod();\n    };\n\n    Scope.prototype.find = function(name) {\n      if (this.check(name)) {\n        return true;\n      }\n      this.add(name, 'var');\n      return false;\n    };\n\n    Scope.prototype.parameter = function(name) {\n      if (this.shared && this.parent.check(name, true)) {\n        return;\n      }\n      return this.add(name, 'param');\n    };\n\n    Scope.prototype.check = function(name) {\n      var _ref1;\n      return !!(this.type(name) || ((_ref1 = this.parent) != null ? _ref1.check(name) : void 0));\n    };\n\n    Scope.prototype.temporary = function(name, index) {\n      if (name.length > 1) {\n        return '_' + name + (index > 1 ? index - 1 : '');\n      } else {\n        return '_' + (index + parseInt(name, 36)).toString(36).replace(/\\d/g, 'a');\n      }\n    };\n\n    Scope.prototype.type = function(name) {\n      var v, _i, _len, _ref1;\n      _ref1 = this.variables;\n      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {\n        v = _ref1[_i];\n        if (v.name === name) {\n          return v.type;\n        }\n      }\n      return null;\n    };\n\n    Scope.prototype.freeVariable = function(name, reserve) {\n      var index, temp;\n      if (reserve == null) {\n        reserve = true;\n      }\n      index = 0;\n      while (this.check((temp = this.temporary(name, index)))) {\n        index++;\n      }\n      if (reserve) {\n        this.add(temp, 'var', true);\n      }\n      return temp;\n    };\n\n    Scope.prototype.assign = function(name, value) {\n      this.add(name, {\n        value: value,\n        assigned: true\n      }, true);\n      return this.hasAssignments = true;\n    };\n\n    Scope.prototype.hasDeclarations = function() {\n      return !!this.declaredVariables().length;\n    };\n\n    Scope.prototype.declaredVariables = function() {\n      var realVars, tempVars, v, _i, _len, _ref1;\n      realVars = [];\n      tempVars = [];\n      _ref1 = this.variables;\n      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {\n        v = _ref1[_i];\n        if (v.type === 'var') {\n          (v.name.charAt(0) === '_' ? tempVars : realVars).push(v.name);\n        }\n      }\n      return realVars.sort().concat(tempVars.sort());\n    };\n\n    Scope.prototype.assignedVariables = function() {\n      var v, _i, _len, _ref1, _results;\n      _ref1 = this.variables;\n      _results = [];\n      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {\n        v = _ref1[_i];\n        if (v.type.assigned) {\n          _results.push(\"\" + v.name + \" = \" + v.type.value);\n        }\n      }\n      return _results;\n    };\n\n    return Scope;\n\n  })();\n\n}).call(this);\n"]}
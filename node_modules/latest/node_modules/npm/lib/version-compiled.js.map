{"version":3,"sources":["version.js"],"names":[],"mappings":"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","file":"version-compiled.js","sourcesContent":["// npm version <newver>\n\nmodule.exports = version\n\nvar semver = require(\"semver\")\n  , path = require(\"path\")\n  , fs = require(\"graceful-fs\")\n  , writeFileAtomic = require(\"write-file-atomic\")\n  , chain = require(\"slide\").chain\n  , log = require(\"npmlog\")\n  , npm = require(\"./npm.js\")\n  , git = require(\"./utils/git.js\")\n  , assert = require(\"assert\")\n\nversion.usage = \"npm version [<newversion> | major | minor | patch | prerelease | preminor | premajor ]\\n\"\n              + \"\\n(run in package dir)\\n\"\n              + \"'npm -v' or 'npm --version' to print npm version \"\n              + \"(\"+npm.version+\")\\n\"\n              + \"'npm view <pkg> version' to view a package's \"\n              + \"published version\\n\"\n              + \"'npm ls' to inspect current package/dependency versions\"\n\nfunction version (args, silent, cb_) {\n  if (typeof cb_ !== \"function\") cb_ = silent, silent = false\n  if (args.length > 1) return cb_(version.usage)\n\n  var packagePath = path.join(npm.localPrefix, \"package.json\")\n  fs.readFile(packagePath, function (er, data) {\n    function cb (er) {\n      if (!er && !silent) console.log(\"v\" + data.version)\n      cb_(er)\n    }\n\n    if (data) data = data.toString()\n    try {\n      data = JSON.parse(data)\n    }\n    catch (er) {\n      data = null\n    }\n\n    if (!args.length) return dump(data, cb_)\n\n    if (er) {\n      log.error(\"version\", \"No package.json found\")\n      return cb_(er)\n    }\n\n    var newVersion = semver.valid(args[0])\n    if (!newVersion) newVersion = semver.inc(data.version, args[0])\n    if (!newVersion) return cb_(version.usage)\n    if (data.version === newVersion) return cb_(new Error(\"Version not changed\"))\n    data.version = newVersion\n\n    checkGit(function (er, hasGit) {\n      if (er) return cb_(er)\n\n      write(data, \"package.json\", function (er) {\n        if (er) return cb_(er)\n\n        updateShrinkwrap(newVersion, function (er, hasShrinkwrap) {\n          if (er || !hasGit) return cb(er)\n\n          commit(data.version, hasShrinkwrap, cb)\n        })\n      })\n    })\n  })\n}\n\nfunction updateShrinkwrap (newVersion, cb) {\n  fs.readFile(path.join(npm.localPrefix, \"npm-shrinkwrap.json\"), function (er, data) {\n    if (er && er.code === \"ENOENT\") return cb(null, false)\n\n    try {\n      data = data.toString()\n      data = JSON.parse(data)\n    }\n    catch (er) {\n      log.error(\"version\", \"Bad npm-shrinkwrap.json data\")\n      return cb(er)\n    }\n\n    data.version = newVersion\n    write(data, \"npm-shrinkwrap.json\", function (er) {\n      if (er) {\n        log.error(\"version\", \"Bad npm-shrinkwrap.json data\")\n        return cb(er)\n      }\n      cb(null, true)\n    })\n  })\n}\n\nfunction dump (data, cb) {\n  var v = {}\n\n  if (data && data.name && data.version) v[data.name] = data.version\n  v.npm = npm.version\n  Object.keys(process.versions).sort().forEach(function (k) {\n    v[k] = process.versions[k]\n  })\n\n  if (npm.config.get(\"json\")) v = JSON.stringify(v, null, 2)\n\n  console.log(v)\n  cb()\n}\n\nfunction checkGit (cb) {\n  fs.stat(path.join(npm.localPrefix, \".git\"), function (er, s) {\n    var doGit = !er && s.isDirectory() && npm.config.get(\"git-tag-version\")\n    if (!doGit) {\n      if (er) log.verbose(\"version\", \"error checking for .git\", er)\n      log.verbose(\"version\", \"not tagging in git\")\n      return cb(null, false)\n    }\n\n    // check for git\n    git.whichAndExec(\n      [ \"status\", \"--porcelain\" ],\n      { env : process.env },\n      function (er, stdout) {\n        if (er && er.code === \"ENOGIT\") {\n          log.warn(\n            \"version\",\n            \"This is a Git checkout, but the git command was not found.\",\n            \"npm could not create a Git tag for this release!\"\n          )\n          return cb(null, false)\n        }\n\n        var lines = stdout.trim().split(\"\\n\").filter(function (line) {\n          return line.trim() && !line.match(/^\\?\\? /)\n        }).map(function (line) {\n          return line.trim()\n        })\n        if (lines.length) return cb(new Error(\n          \"Git working directory not clean.\\n\"+lines.join(\"\\n\")\n        ))\n\n        cb(null, true)\n      }\n    )\n  })\n}\n\nfunction commit (version, hasShrinkwrap, cb) {\n  var options = { env : process.env }\n  var message = npm.config.get(\"message\").replace(/%s/g, version)\n  var sign = npm.config.get(\"sign-git-tag\")\n  var flag = sign ? \"-sm\" : \"-am\"\n  chain(\n    [\n      git.chainableExec([ \"add\", \"package.json\" ], options),\n      hasShrinkwrap && git.chainableExec([ \"add\", \"npm-shrinkwrap.json\" ] , options),\n      git.chainableExec([ \"commit\", \"-m\", message ], options),\n      git.chainableExec([ \"tag\", npm.config.get(\"tag-version-prefix\") + version, flag, message ], options)\n    ],\n    cb\n  )\n}\n\nfunction write (data, file, cb) {\n  assert(data && typeof data === \"object\", \"must pass data to version write\")\n  assert(typeof file === \"string\", \"must pass filename to write to version write\")\n\n  log.verbose(\"version.write\", \"data\", data, \"to\", file)\n  writeFileAtomic(\n    path.join(npm.localPrefix, file),\n    new Buffer(JSON.stringify(data, null, 2) + \"\\n\"),\n    cb\n  )\n}\n"]}
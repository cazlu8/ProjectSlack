{"version":3,"sources":["get-stat.js"],"names":[],"mappings":"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","file":"get-stat-compiled.js","sourcesContent":["var mkdir = require(\"mkdirp\")\n  , fs = require(\"graceful-fs\")\n  , log = require(\"npmlog\")\n  , chownr = require(\"chownr\")\n  , npm = require(\"../npm.js\")\n  , inflight = require(\"inflight\")\n\n// to maintain the cache dir's permissions consistently.\nvar cacheStat = null\nmodule.exports = function getCacheStat (cb) {\n  if (cacheStat) return cb(null, cacheStat)\n\n  fs.stat(npm.cache, function (er, st) {\n    if (er) return makeCacheDir(cb)\n    if (!st.isDirectory()) {\n      log.error(\"getCacheStat\", \"invalid cache dir %j\", npm.cache)\n      return cb(er)\n    }\n    return cb(null, cacheStat = st)\n  })\n}\n\nfunction makeCacheDir (cb) {\n  cb = inflight(\"makeCacheDir\", cb)\n  if (!cb) {\n    return log.verbose(\n      \"getCacheStat\",\n      \"cache creation already in flight; waiting\"\n    )\n  }\n  log.verbose(\"getCacheStat\", \"cache creation not in flight; initializing\")\n\n  if (!process.getuid) return mkdir(npm.cache, function (er) {\n    log.verbose(\"makeCacheDir\", \"UID & GID are irrelevant on\", process.platform)\n    cacheStat = { uid : 0, gid : 0 }\n    return cb(er, cacheStat)\n  })\n\n  var uid = +process.getuid()\n    , gid = +process.getgid()\n\n  if (uid === 0) {\n    if (process.env.SUDO_UID) uid = +process.env.SUDO_UID\n    if (process.env.SUDO_GID) gid = +process.env.SUDO_GID\n  }\n\n  if (uid !== 0 || !process.env.HOME) {\n    cacheStat = { uid : uid, gid : gid }\n    return mkdir(npm.cache, afterMkdir)\n  }\n\n  fs.stat(process.env.HOME, function (er, st) {\n    if (er) {\n      log.error(\"makeCacheDir\", \"homeless?\")\n      return cb(er)\n    }\n    cacheStat = st\n    log.silly(\"makeCacheDir\", \"cache dir uid, gid\", [st.uid, st.gid])\n    return mkdir(npm.cache, afterMkdir)\n  })\n\n  function afterMkdir (er, made) {\n    if (er || !cacheStat || isNaN(cacheStat.uid) || isNaN(cacheStat.gid)) {\n      return cb(er, cacheStat)\n    }\n\n    if (!made) return cb(er, cacheStat)\n\n    // ensure that the ownership is correct.\n    chownr(made, cacheStat.uid, cacheStat.gid, function (er) {\n      return cb(er, cacheStat)\n    })\n  }\n}\n"]}
{"version":3,"sources":["cache.js"],"names":[],"mappings":"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","file":"cache-compiled.js","sourcesContent":["// XXX lib/utils/tar.js and this file need to be rewritten.\n\n// URL-to-cache folder mapping:\n// : -> !\n// @ -> _\n// http://registry.npmjs.org/foo/version -> cache/http!/...\n//\n\n/*\nfetching a URL:\n1. Check for URL in inflight URLs.  If present, add cb, and return.\n2. Acquire lock at {cache}/{sha(url)}.lock\n   retries = {cache-lock-retries, def=3}\n   stale = {cache-lock-stale, def=30000}\n   wait = {cache-lock-wait, def=100}\n3. if lock can't be acquired, then fail\n4. fetch url, clear lock, call cbs\n\ncache folders:\n1. urls: http!/server.com/path/to/thing\n2. c:\\path\\to\\thing: file!/c!/path/to/thing\n3. /path/to/thing: file!/path/to/thing\n4. git@ private: git_github.com!npm/npm\n5. git://public: git!/github.com/npm/npm\n6. git+blah:// git-blah!/server.com/foo/bar\n\nadding a folder:\n1. tar into tmp/random/package.tgz\n2. untar into tmp/random/contents/package, stripping one dir piece\n3. tar tmp/random/contents/package to cache/n/v/package.tgz\n4. untar cache/n/v/package.tgz into cache/n/v/package\n5. rm tmp/random\n\nAdding a url:\n1. fetch to tmp/random/package.tgz\n2. goto folder(2)\n\nadding a name@version:\n1. registry.get(name/version)\n2. if response isn't 304, add url(dist.tarball)\n\nadding a name@range:\n1. registry.get(name)\n2. Find a version that satisfies\n3. add name@version\n\nadding a local tarball:\n1. untar to tmp/random/{blah}\n2. goto folder(2)\n\nadding a namespaced package:\n1. lookup registry for @namespace\n2. namespace_registry.get('name')\n3. add url(namespace/latest.tarball)\n*/\n\nexports = module.exports = cache\n\ncache.unpack = unpack\ncache.clean = clean\ncache.read = read\n\nvar npm = require(\"./npm.js\")\n  , fs = require(\"graceful-fs\")\n  , writeFileAtomic = require(\"write-file-atomic\")\n  , assert = require(\"assert\")\n  , rm = require(\"./utils/gently-rm.js\")\n  , readJson = require(\"read-package-json\")\n  , log = require(\"npmlog\")\n  , path = require(\"path\")\n  , asyncMap = require(\"slide\").asyncMap\n  , tar = require(\"./utils/tar.js\")\n  , fileCompletion = require(\"./utils/completion/file-completion.js\")\n  , deprCheck = require(\"./utils/depr-check.js\")\n  , addNamed = require(\"./cache/add-named.js\")\n  , addLocal = require(\"./cache/add-local.js\")\n  , addRemoteTarball = require(\"./cache/add-remote-tarball.js\")\n  , addRemoteGit = require(\"./cache/add-remote-git.js\")\n  , inflight = require(\"inflight\")\n  , realizePackageSpecifier = require(\"realize-package-specifier\")\n  , npa = require(\"npm-package-arg\")\n  , getStat = require(\"./cache/get-stat.js\")\n  , cachedPackageRoot = require(\"./cache/cached-package-root.js\")\n  , mapToRegistry = require(\"./utils/map-to-registry.js\")\n\ncache.usage = \"npm cache add <tarball file>\"\n            + \"\\nnpm cache add <folder>\"\n            + \"\\nnpm cache add <tarball url>\"\n            + \"\\nnpm cache add <git url>\"\n            + \"\\nnpm cache add <name>@<version>\"\n            + \"\\nnpm cache ls [<path>]\"\n            + \"\\nnpm cache clean [<pkg>[@<version>]]\"\n\ncache.completion = function (opts, cb) {\n\n  var argv = opts.conf.argv.remain\n  if (argv.length === 2) {\n    return cb(null, [\"add\", \"ls\", \"clean\"])\n  }\n\n  switch (argv[2]) {\n    case \"clean\":\n    case \"ls\":\n      // cache and ls are easy, because the completion is\n      // what ls_ returns anyway.\n      // just get the partial words, minus the last path part\n      var p = path.dirname(opts.partialWords.slice(3).join(\"/\"))\n      if (p === \".\") p = \"\"\n      return ls_(p, 2, cb)\n    case \"add\":\n      // Same semantics as install and publish.\n      return npm.commands.install.completion(opts, cb)\n  }\n}\n\nfunction cache (args, cb) {\n  var cmd = args.shift()\n  switch (cmd) {\n    case \"rm\": case \"clear\": case \"clean\": return clean(args, cb)\n    case \"list\": case \"sl\": case \"ls\": return ls(args, cb)\n    case \"add\": return add(args, npm.prefix, cb)\n    default: return cb(\"Usage: \"+cache.usage)\n  }\n}\n\n// if the pkg and ver are in the cache, then\n// just do a readJson and return.\n// if they're not, then fetch them from the registry.\nfunction read (name, ver, forceBypass, cb) {\n  assert(typeof name === \"string\", \"must include name of module to install\")\n  assert(typeof cb === \"function\", \"must include callback\")\n\n  if (forceBypass === undefined || forceBypass === null) forceBypass = true\n\n  var root = cachedPackageRoot({name : name, version : ver})\n  function c (er, data) {\n    if (er) log.verbose(\"cache\", \"addNamed error for\", name+\"@\"+ver, er)\n    if (data) deprCheck(data)\n\n    return cb(er, data)\n  }\n\n  if (forceBypass && npm.config.get(\"force\")) {\n    log.verbose(\"using force\", \"skipping cache\")\n    return addNamed(name, ver, null, c)\n  }\n\n  readJson(path.join(root, \"package\", \"package.json\"), function (er, data) {\n    if (er && er.code !== \"ENOENT\" && er.code !== \"ENOTDIR\") return cb(er)\n\n    if (data) {\n      if (!data.name) return cb(new Error(\"No name provided\"))\n      if (!data.version) return cb(new Error(\"No version provided\"))\n    }\n\n    if (er) return addNamed(name, ver, null, c)\n    else c(er, data)\n  })\n}\n\nfunction normalize (args) {\n  var normalized = \"\"\n  if (args.length > 0) {\n    var a = npa(args[0])\n    if (a.name) normalized = a.name\n    if (a.rawSpec) normalized = [normalized, a.rawSpec].join(\"/\")\n    if (args.length > 1) normalized = [normalized].concat(args.slice(1)).join(\"/\")\n  }\n\n  if (normalized.substr(-1) === \"/\") {\n    normalized = normalized.substr(0, normalized.length - 1)\n  }\n  normalized = path.normalize(normalized)\n  log.silly(\"ls\", \"normalized\", normalized)\n\n  return normalized\n}\n\n// npm cache ls [<path>]\nfunction ls (args, cb) {\n  var prefix = npm.config.get(\"cache\")\n  if (prefix.indexOf(process.env.HOME) === 0) {\n    prefix = \"~\" + prefix.substr(process.env.HOME.length)\n  }\n  ls_(normalize(args), npm.config.get(\"depth\"), function (er, files) {\n    console.log(files.map(function (f) {\n      return path.join(prefix, f)\n    }).join(\"\\n\").trim())\n    cb(er, files)\n  })\n}\n\n// Calls cb with list of cached pkgs matching show.\nfunction ls_ (req, depth, cb) {\n  return fileCompletion(npm.cache, req, depth, cb)\n}\n\n// npm cache clean [<path>]\nfunction clean (args, cb) {\n  assert(typeof cb === \"function\", \"must include callback\")\n\n  if (!args) args = []\n\n  var f = path.join(npm.cache, normalize(args))\n  if (f === npm.cache) {\n    fs.readdir(npm.cache, function (er, files) {\n      if (er) return cb()\n      asyncMap( files.filter(function (f) {\n                  return npm.config.get(\"force\") || f !== \"-\"\n                }).map(function (f) {\n                  return path.join(npm.cache, f)\n                })\n              , rm, cb )\n    })\n  }\n  else {\n    rm(f, cb)\n  }\n}\n\n// npm cache add <tarball-url>\n// npm cache add <pkg> <ver>\n// npm cache add <tarball>\n// npm cache add <folder>\ncache.add = function (pkg, ver, where, scrub, cb) {\n  assert(typeof pkg === \"string\", \"must include name of package to install\")\n  assert(typeof cb === \"function\", \"must include callback\")\n\n  if (scrub) {\n    return clean([], function (er) {\n      if (er) return cb(er)\n      add([pkg, ver], where, cb)\n    })\n  }\n  return add([pkg, ver], where, cb)\n}\n\n\nvar adding = 0\nfunction add (args, where, cb) {\n  // this is hot code.  almost everything passes through here.\n  // the args can be any of:\n  // [\"url\"]\n  // [\"pkg\", \"version\"]\n  // [\"pkg@version\"]\n  // [\"pkg\", \"url\"]\n  // This is tricky, because urls can contain @\n  // Also, in some cases we get [name, null] rather\n  // that just a single argument.\n\n  var usage = \"Usage:\\n\"\n            + \"    npm cache add <tarball-url>\\n\"\n            + \"    npm cache add <pkg>@<ver>\\n\"\n            + \"    npm cache add <tarball>\\n\"\n            + \"    npm cache add <folder>\\n\"\n    , spec\n\n  log.silly(\"cache add\", \"args\", args)\n\n  if (args[1] === undefined) args[1] = null\n\n  // at this point the args length must ==2\n  if (args[1] !== null) {\n    spec = args[0]+\"@\"+args[1]\n  } else if (args.length === 2) {\n    spec = args[0]\n  }\n\n  log.verbose(\"cache add\", \"spec\", spec)\n\n  if (!spec) return cb(usage)\n\n  if (adding <= 0) {\n    npm.spinner.start()\n  }\n  adding++\n  cb = afterAdd(cb)\n\n  realizePackageSpecifier(spec, where, function (err, p) {\n    if (err) return cb(err)\n\n    log.silly(\"cache add\", \"parsed spec\", p)\n\n    switch (p.type) {\n      case \"local\":\n      case \"directory\":\n        addLocal(p, null, cb)\n        break\n      case \"remote\":\n        // get auth, if possible\n        mapToRegistry(spec, npm.config, function (err, uri, auth) {\n          if (err) return cb(err)\n\n          addRemoteTarball(p.spec, {name : p.name}, null, auth, cb)\n        })\n        break\n      case \"git\":\n      case \"hosted\":\n        addRemoteGit(p.rawSpec, cb)\n        break\n      default:\n        if (p.name) return addNamed(p.name, p.spec, null, cb)\n\n        cb(new Error(\"couldn't figure out how to install \" + spec))\n    }\n  })\n}\n\nfunction unpack (pkg, ver, unpackTarget, dMode, fMode, uid, gid, cb) {\n  if (typeof cb !== \"function\") cb = gid, gid = null\n  if (typeof cb !== \"function\") cb = uid, uid = null\n  if (typeof cb !== \"function\") cb = fMode, fMode = null\n  if (typeof cb !== \"function\") cb = dMode, dMode = null\n\n  read(pkg, ver, false, function (er) {\n    if (er) {\n      log.error(\"unpack\", \"Could not read data for %s\", pkg + \"@\" + ver)\n      return cb(er)\n    }\n    npm.commands.unbuild([unpackTarget], true, function (er) {\n      if (er) return cb(er)\n      tar.unpack( path.join(cachedPackageRoot({name : pkg, version : ver}), \"package.tgz\")\n                , unpackTarget\n                , dMode, fMode\n                , uid, gid\n                , cb )\n    })\n  })\n}\n\nfunction afterAdd (cb) { return function (er, data) {\n  adding--\n  if (adding <= 0) npm.spinner.stop()\n\n  if (er || !data || !data.name || !data.version) return cb(er, data)\n  log.silly(\"cache\", \"afterAdd\", data.name+\"@\"+data.version)\n\n  // Save the resolved, shasum, etc. into the data so that the next\n  // time we load from this cached data, we have all the same info.\n  var pj = path.join(cachedPackageRoot(data), \"package\", \"package.json\")\n\n  var done = inflight(pj, cb)\n  if (!done) return log.verbose(\"afterAdd\", pj, \"already in flight; not writing\")\n  log.verbose(\"afterAdd\", pj, \"not in flight; writing\")\n\n  getStat(function (er, cs) {\n    if (er) return done(er)\n    writeFileAtomic(pj, JSON.stringify(data), {chown : cs}, function (er) {\n      if (!er) log.verbose(\"afterAdd\", pj, \"written\")\n      return done(er, data)\n    })\n  })\n}}\n"]}
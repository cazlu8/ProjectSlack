{"version":3,"sources":["owner.js"],"names":[],"mappings":"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","file":"owner-compiled.js","sourcesContent":["module.exports = owner\n\nowner.usage = \"npm owner add <username> <pkg>\"\n            + \"\\nnpm owner rm <username> <pkg>\"\n            + \"\\nnpm owner ls <pkg>\"\n\nvar npm = require(\"./npm.js\")\n  , log = require(\"npmlog\")\n  , mapToRegistry = require(\"./utils/map-to-registry.js\")\n  , readLocalPkg = require(\"./utils/read-local-package.js\")\n\nowner.completion = function (opts, cb) {\n  var argv = opts.conf.argv.remain\n  if (argv.length > 4) return cb()\n  if (argv.length <= 2) {\n    var subs = [\"add\", \"rm\"]\n    if (opts.partialWord === \"l\") subs.push(\"ls\")\n    else subs.push(\"ls\", \"list\")\n    return cb(null, subs)\n  }\n\n  npm.commands.whoami([], true, function (er, username) {\n    if (er) return cb()\n\n    var un = encodeURIComponent(username)\n    var byUser, theUser\n    switch (argv[2]) {\n      case \"ls\":\n        // FIXME: there used to be registry completion here, but it stopped\n        // making sense somewhere around 50,000 packages on the registry\n        return cb()\n\n      case \"rm\":\n        if (argv.length > 3) {\n          theUser = encodeURIComponent(argv[3])\n          byUser = \"-/by-user/\" + theUser + \"|\" + un\n          return mapToRegistry(byUser, npm.config, function (er, uri, auth) {\n            if (er) return cb(er)\n\n            console.error(uri)\n            npm.registry.get(uri, { auth : auth }, function (er, d) {\n              if (er) return cb(er)\n              // return the intersection\n              return cb(null, d[theUser].filter(function (p) {\n                // kludge for server adminery.\n                return un === \"isaacs\" || d[un].indexOf(p) === -1\n              }))\n            })\n          })\n        }\n        // else fallthrough\n      case \"add\":\n        if (argv.length > 3) {\n          theUser = encodeURIComponent(argv[3])\n          byUser = \"-/by-user/\" + theUser + \"|\" + un\n          return mapToRegistry(byUser, npm.config, function (er, uri, auth) {\n            if (er) return cb(er)\n\n            console.error(uri)\n            npm.registry.get(uri, { auth : auth }, function (er, d) {\n              console.error(uri, er || d)\n              // return mine that they're not already on.\n              if (er) return cb(er)\n              var mine = d[un] || []\n                , theirs = d[theUser] || []\n              return cb(null, mine.filter(function (p) {\n                return theirs.indexOf(p) === -1\n              }))\n            })\n          })\n        }\n        // just list all users who aren't me.\n        return mapToRegistry(\"-/users\", npm.config, function (er, uri, auth) {\n          if (er) return cb(er)\n\n          npm.registry.get(uri, { auth : auth }, function (er, list) {\n            if (er) return cb()\n            return cb(null, Object.keys(list).filter(function (n) {\n              return n !== un\n            }))\n          })\n        })\n\n      default:\n        return cb()\n    }\n  })\n}\n\nfunction owner (args, cb) {\n  var action = args.shift()\n  switch (action) {\n    case \"ls\": case \"list\": return ls(args[0], cb)\n    case \"add\": return add(args[0], args[1], cb)\n    case \"rm\": case \"remove\": return rm(args[0], args[1], cb)\n    default: return unknown(action, cb)\n  }\n}\n\nfunction ls (pkg, cb) {\n  if (!pkg) return readLocalPkg(function (er, pkg) {\n    if (er) return cb(er)\n    if (!pkg) return cb(owner.usage)\n    ls(pkg, cb)\n  })\n\n  mapToRegistry(pkg, npm.config, function (er, uri, auth) {\n    if (er) return cb(er)\n\n    npm.registry.get(uri, { auth : auth }, function (er, data) {\n      var msg = \"\"\n      if (er) {\n        log.error(\"owner ls\", \"Couldn't get owner data\", pkg)\n        return cb(er)\n      }\n      var owners = data.maintainers\n      if (!owners || !owners.length) msg = \"admin party!\"\n      else msg = owners.map(function (o) {\n        return o.name + \" <\" + o.email + \">\"\n      }).join(\"\\n\")\n      console.log(msg)\n      cb(er, owners)\n    })\n  })\n}\n\nfunction add (user, pkg, cb) {\n  if (!user) return cb(owner.usage)\n  if (!pkg) return readLocalPkg(function (er, pkg) {\n    if (er) return cb(er)\n    if (!pkg) return cb(new Error(owner.usage))\n    add(user, pkg, cb)\n  })\n\n  log.verbose(\"owner add\", \"%s to %s\", user, pkg)\n  mutate(pkg, user, function (u, owners) {\n    if (!owners) owners = []\n    for (var i = 0, l = owners.length; i < l; i ++) {\n      var o = owners[i]\n      if (o.name === u.name) {\n        log.info( \"owner add\"\n                , \"Already a package owner: \" + o.name + \" <\" + o.email + \">\")\n        return false\n      }\n    }\n    owners.push(u)\n    return owners\n  }, cb)\n}\n\nfunction rm (user, pkg, cb) {\n  if (!pkg) return readLocalPkg(function (er, pkg) {\n    if (er) return cb(er)\n    if (!pkg) return cb(new Error(owner.usage))\n    rm(user, pkg, cb)\n  })\n\n  log.verbose(\"owner rm\", \"%s from %s\", user, pkg)\n  mutate(pkg, user, function (u, owners) {\n    var found = false\n      , m = owners.filter(function (o) {\n          var match = (o.name === user)\n          found = found || match\n          return !match\n        })\n    if (!found) {\n      log.info(\"owner rm\", \"Not a package owner: \" + user)\n      return false\n    }\n    if (!m.length) return new Error(\n      \"Cannot remove all owners of a package.  Add someone else first.\")\n    return m\n  }, cb)\n}\n\nfunction mutate (pkg, user, mutation, cb) {\n  if (user) {\n    var byUser = \"-/user/org.couchdb.user:\" + user\n    mapToRegistry(byUser, npm.config, function (er, uri, auth) {\n      if (er) return cb(er)\n\n      npm.registry.get(uri, { auth : auth }, mutate_)\n    })\n  } else {\n    mutate_(null, null)\n  }\n\n  function mutate_ (er, u) {\n    if (!er && user && (!u || u.error)) er = new Error(\n      \"Couldn't get user data for \" + user + \": \" + JSON.stringify(u))\n\n    if (er) {\n      log.error(\"owner mutate\", \"Error getting user data for %s\", user)\n      return cb(er)\n    }\n\n    if (u) u = { \"name\" : u.name, \"email\" : u.email }\n    mapToRegistry(pkg, npm.config, function (er, uri, auth) {\n      if (er) return cb(er)\n\n      npm.registry.get(uri, { auth : auth }, function (er, data) {\n        if (er) {\n          log.error(\"owner mutate\", \"Error getting package data for %s\", pkg)\n          return cb(er)\n        }\n\n        // save the number of maintainers before mutation so that we can figure\n        // out if maintainers were added or removed\n        var beforeMutation = data.maintainers.length\n\n        var m = mutation(u, data.maintainers)\n        if (!m) return cb() // handled\n        if (m instanceof Error) return cb(m) // error\n\n        data = {\n          _id : data._id,\n          _rev : data._rev,\n          maintainers : m\n        }\n        var dataPath = pkg.replace(\"/\", \"%2f\") + \"/-rev/\" + data._rev\n        mapToRegistry(dataPath, npm.config, function (er, uri, auth) {\n          if (er) return cb(er)\n\n          var params = {\n            method : \"PUT\",\n            body : data,\n            auth : auth\n          }\n          npm.registry.request(uri, params, function (er, data) {\n            if (!er && data.error) {\n              er = new Error(\"Failed to update package metadata: \"+JSON.stringify(data))\n            }\n\n            if (er) {\n              log.error(\"owner mutate\", \"Failed to update package metadata\")\n            }\n            else if (m.length > beforeMutation) {\n              console.log(\"+ %s (%s)\", user, pkg)\n            }\n            else if (m.length < beforeMutation) {\n              console.log(\"- %s (%s)\", user, pkg)\n            }\n\n            cb(er, data)\n          })\n        })\n      })\n    })\n  }\n}\n\nfunction unknown (action, cb) {\n  cb(\"Usage: \\n\" + owner.usage)\n}\n"]}
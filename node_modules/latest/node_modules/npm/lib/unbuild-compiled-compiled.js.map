{"version":3,"sources":["unbuild-compiled.js"],"names":[],"mappings":"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","file":"unbuild-compiled-compiled.js","sourcesContent":["\"use strict\";\n\nmodule.exports = unbuild;\nunbuild.usage = \"npm unbuild <folder>\\n(this is plumbing)\";\n\nvar readJson = require(\"read-package-json\"),\n    gentlyRm = require(\"./utils/gently-rm.js\"),\n    npm = require(\"./npm.js\"),\n    path = require(\"path\"),\n    isInside = require(\"path-is-inside\"),\n    lifecycle = require(\"./utils/lifecycle.js\"),\n    asyncMap = require(\"slide\").asyncMap,\n    chain = require(\"slide\").chain,\n    log = require(\"npmlog\"),\n    build = require(\"./build.js\");\n\n// args is a list of folders.\n// remove any bins/etc, and then delete the folder.\nfunction unbuild(args, silent, cb) {\n  if (typeof silent === \"function\") cb = silent, silent = false;\n  asyncMap(args, unbuild_(silent), cb);\n}\n\nfunction unbuild_(silent) {\n  return function (folder, cb_) {\n    function cb(er) {\n      cb_(er, path.relative(npm.root, folder));\n    }\n    folder = path.resolve(folder);\n    var base = isInside(folder, npm.prefix) ? npm.prefix : folder;\n    delete build._didBuild[folder];\n    log.verbose(\"unbuild\", folder.substr(npm.prefix.length + 1));\n    readJson(path.resolve(folder, \"package.json\"), function (er, pkg) {\n      // if no json, then just trash it, but no scripts or whatever.\n      if (er) return gentlyRm(folder, false, base, cb);\n      chain([[lifecycle, pkg, \"preuninstall\", folder, false, true], [lifecycle, pkg, \"uninstall\", folder, false, true], !silent && function (cb) {\n        console.log(\"unbuild \" + pkg._id);\n        cb();\n      }, [rmStuff, pkg, folder], [lifecycle, pkg, \"postuninstall\", folder, false, true], [gentlyRm, folder, false, base]], cb);\n    });\n  };\n}\n\nfunction rmStuff(pkg, folder, cb) {\n  // if it's global, and folder is in {prefix}/node_modules,\n  // then bins are in {prefix}/bin\n  // otherwise, then bins are in folder/../.bin\n  var parent = path.dirname(folder),\n      gnm = npm.dir,\n      top = gnm === parent;\n\n  log.verbose(\"unbuild rmStuff\", pkg._id, \"from\", gnm);\n  if (!top) log.verbose(\"unbuild rmStuff\", \"in\", parent);\n  asyncMap([rmBins, rmMans], function (fn, cb) {\n    fn(pkg, folder, parent, top, cb);\n  }, cb);\n}\n\nfunction rmBins(pkg, folder, parent, top, cb) {\n  if (!pkg.bin) return cb();\n  var binRoot = top ? npm.bin : path.resolve(parent, \".bin\");\n  asyncMap(Object.keys(pkg.bin), function (b, cb) {\n    if (process.platform === \"win32\") {\n      chain([[gentlyRm, path.resolve(binRoot, b) + \".cmd\", true], [gentlyRm, path.resolve(binRoot, b), true]], cb);\n    } else {\n      gentlyRm(path.resolve(binRoot, b), true, cb);\n    }\n  }, cb);\n}\n\nfunction rmMans(pkg, folder, parent, top, cb) {\n  if (!pkg.man || !top || process.platform === \"win32\" || !npm.config.get(\"global\")) {\n    return cb();\n  }\n  var manRoot = path.resolve(npm.config.get(\"prefix\"), \"share\", \"man\");\n  log.verbose(\"rmMans\", \"man files are\", pkg.man, \"in\", manRoot);\n  asyncMap(pkg.man, function (man, cb) {\n    if (Array.isArray(man)) {\n      man.forEach(rmMan);\n    } else {\n      rmMan(man);\n    }\n\n    function rmMan(man) {\n      log.silly(\"rmMan\", \"preparing to remove\", man);\n      var parseMan = man.match(/(.*\\.([0-9]+)(\\.gz)?)$/);\n      if (!parseMan) {\n        log.error(\"rmMan\", man, \"is not a valid name for a man file.\", \"Man files must end with a number, \" + \"and optionally a .gz suffix if they are compressed.\");\n        return cb();\n      }\n\n      var stem = parseMan[1];\n      var sxn = parseMan[2];\n      var gz = parseMan[3] || \"\";\n      var bn = path.basename(stem);\n      var manDest = path.join(manRoot, \"man\" + sxn, (bn.indexOf(pkg.name) === 0 ? bn : pkg.name + \"-\" + bn) + \".\" + sxn + gz);\n      gentlyRm(manDest, true, cb);\n    }\n  }, cb);\n}\n\n//# sourceMappingURL=unbuild-compiled.js.map"]}
{"version":3,"sources":["rebuild.js"],"names":[],"mappings":"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","file":"rebuild-compiled.js","sourcesContent":["\nmodule.exports = rebuild\n\nvar readInstalled = require(\"read-installed\")\n  , semver = require(\"semver\")\n  , log = require(\"npmlog\")\n  , npm = require(\"./npm.js\")\n  , npa = require(\"npm-package-arg\")\n\nrebuild.usage = \"npm rebuild [<name>[@<version>] [name[@<version>] ...]]\"\n\nrebuild.completion = require(\"./utils/completion/installed-deep.js\")\n\nfunction rebuild (args, cb) {\n  var opt = { depth: npm.config.get(\"depth\"), dev: true }\n  readInstalled(npm.prefix, opt, function (er, data) {\n    log.info(\"readInstalled\", typeof data)\n    if (er) return cb(er)\n    var set = filter(data, args)\n      , folders = Object.keys(set).filter(function (f) {\n          return f !== npm.prefix\n        })\n    if (!folders.length) return cb()\n    log.silly(\"rebuild set\", folders)\n    cleanBuild(folders, set, cb)\n  })\n}\n\nfunction cleanBuild (folders, set, cb) {\n  npm.commands.build(folders, function (er) {\n    if (er) return cb(er)\n    console.log(folders.map(function (f) {\n      return set[f] + \" \" + f\n    }).join(\"\\n\"))\n    cb()\n  })\n}\n\nfunction filter (data, args, set, seen) {\n  if (!set) set = {}\n  if (!seen) seen = {}\n  if (set.hasOwnProperty(data.path)) return set\n  if (seen.hasOwnProperty(data.path)) return set\n  seen[data.path] = true\n  var pass\n  if (!args.length) pass = true // rebuild everything\n  else if (data.name && data._id) {\n    for (var i = 0, l = args.length; i < l; i ++) {\n      var arg = args[i]\n        , nv = npa(arg)\n        , n = nv.name\n        , v = nv.rawSpec\n      if (n !== data.name) continue\n      if (!semver.satisfies(data.version, v, true)) continue\n      pass = true\n      break\n    }\n  }\n  if (pass && data._id) {\n    log.verbose(\"rebuild\", \"path, id\", [data.path, data._id])\n    set[data.path] = data._id\n  }\n  // need to also dive through kids, always.\n  // since this isn't an install these won't get auto-built unless\n  // they're not dependencies.\n  Object.keys(data.dependencies || {}).forEach(function (d) {\n    // return\n    var dep = data.dependencies[d]\n    if (typeof dep === \"string\") return\n    filter(dep, args, set, seen)\n  })\n  return set\n}\n"]}
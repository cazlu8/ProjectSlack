{"version":3,"sources":["access.js"],"names":[],"mappings":"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","file":"access-compiled.js","sourcesContent":["var assert = require(\"assert\")\nvar resolve = require(\"path\").resolve\nvar url = require(\"url\")\n\nvar log = require(\"npmlog\")\nvar readPackageJson = require(\"read-package-json\")\n\nvar mapToRegistry = require(\"./utils/map-to-registry.js\")\nvar npa = require(\"npm-package-arg\")\nvar npm = require(\"./npm.js\")\n\nmodule.exports = access\n\naccess.usage = \"npm access public [<package>]\"\n             + \"\\nnpm access restricted [<package>]\"\n             + \"\\nnpm access add <read-only|read-write> <entity> [<package>]\"\n             + \"\\nnpm access rm <entity> [<package>]\"\n             + \"\\nnpm access ls [<package>]\"\n             + \"\\nnpm access edit [<package>]\"\n\naccess.completion = function (opts, cb) {\n  var argv = opts.conf.argv.remain\n  if (argv.length === 2) {\n    return cb(null, [\"public\", \"restricted\", \"add\", \"rm\", \"ls\", \"edit\"])\n  }\n\n  switch (argv[2]) {\n    case \"public\":\n    case \"restricted\":\n    case \"ls\":\n    case \"edit\":\n      return cb(new Error(\"unimplemented: packages you can change\"))\n    case \"add\":\n      if (argv.length === 3) return cb(null, [\"read-only\", \"read-write\"])\n\n      return cb(new Error(\"unimplemented: entities and packages\"))\n    case \"rm\":\n      return cb(new Error(\"unimplemented: entities and packages\"))\n    default:\n      return cb(new Error(argv[2]+\" not recognized\"))\n  }\n}\n\nfunction access (args, cb) {\n  var cmd = args.shift()\n  switch (cmd) {\n    case \"public\": case \"restricted\": return changeAccess(args, cmd, cb)\n    case \"add\": case \"set\": return add(args, cb)\n    case \"rm\": case \"del\": case \"clear\": return rm(args, cb)\n    case \"list\": case \"sl\": case \"ls\": return ls(args, cb)\n    case \"edit\": case \"ed\": return edit(args, cb)\n    default: return cb(\"Usage:\\n\"+access.usage)\n  }\n}\n\nfunction changeAccess (args, level, cb) {\n  assert(Array.isArray(args), \"changeAccess requires args be an array\")\n  assert(\n    [\"public\", \"restricted\"].indexOf(level) !== -1,\n    \"access level must be either 'public' or 'restricted'\"\n  )\n  assert(typeof cb === \"function\", \"changeAccess requires a callback\")\n\n  var p = (args.shift() || \"\").trim()\n  if (!p) return getCurrentPackage(level, cb)\n  changeAccess_(p, level, cb)\n}\n\nfunction getCurrentPackage (level, cb) {\n  var here = resolve(npm.prefix, \"package.json\")\n  log.verbose(\"setPackageLevel\", \"here\", here)\n\n  readPackageJson(here, function (er, data) {\n    if (er) return cb(er)\n\n    if (!data.name) {\n      return cb(new Error(\"Package must be named\"))\n    }\n\n    changeAccess_(data.name, level, cb)\n  })\n}\n\nfunction changeAccess_ (name, level, cb) {\n  log.verbose(\"changeAccess\", \"name\", name, \"level\", level)\n  mapToRegistry(name, npm.config, function (er, uri, auth, base) {\n    if (er) return cb(er)\n\n    var data = npa(name)\n    if (!data.scope) {\n      var msg = \"Sorry, you can't change the access level of unscoped packages.\"\n      log.error(\"access\", msg)\n      return cb(new Error(msg))\n    }\n\n    // name must be scoped, so escape separator\n    name = name.replace(\"/\", \"%2f\")\n    // FIXME: mapToRegistry still isn't generic enough SIGH\n    uri = url.resolve(base, \"-/package/\"+name+\"/access\")\n    var params = {\n      level : level,\n      auth : auth\n    }\n\n    npm.registry.access(uri, params, cb)\n  })\n}\n\nfunction add (args, cb) {\n  return cb(new Error(\"npm access add isn't implemented yet!\"))\n}\n\nfunction rm (args, cb) {\n  return cb(new Error(\"npm access rm isn't implemented yet!\"))\n}\n\nfunction ls (args, cb) {\n  return cb(new Error(\"npm access ls isn't implemented yet!\"))\n}\n\nfunction edit (args, cb) {\n  return cb(new Error(\"npm access edit isn't implemented yet!\"))\n}\n"]}
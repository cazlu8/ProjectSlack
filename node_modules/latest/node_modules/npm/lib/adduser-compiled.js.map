{"version":3,"sources":["adduser.js"],"names":[],"mappings":"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","file":"adduser-compiled.js","sourcesContent":["\nmodule.exports = adduser\n\nvar log = require(\"npmlog\")\n  , npm = require(\"./npm.js\")\n  , read = require(\"read\")\n  , userValidate = require(\"npm-user-validate\")\n  , crypto\n\ntry {\n  crypto = process.binding(\"crypto\") && require(\"crypto\")\n} catch (ex) {}\n\nadduser.usage = \"npm adduser\\nThen enter stuff at the prompts\"\n\nfunction adduser (args, cb) {\n  npm.spinner.stop()\n  if (!crypto) return cb(new Error(\n    \"You must compile node with ssl support to use the adduser feature\"))\n\n  var creds = npm.config.getCredentialsByURI(npm.config.get(\"registry\"))\n  var c = { u : creds.username || \"\"\n          , p : creds.password || \"\"\n          , e : creds.email || \"\"\n          }\n    , u = {}\n    , fns = [readUsername, readPassword, readEmail, save]\n\n  loop()\n  function loop (er) {\n    if (er) return cb(er)\n    var fn = fns.shift()\n    if (fn) return fn(c, u, loop)\n    cb()\n  }\n}\n\nfunction readUsername (c, u, cb) {\n  var v = userValidate.username\n  read({prompt: \"Username: \", default: c.u || \"\"}, function (er, un) {\n    if (er) {\n      return cb(er.message === \"cancelled\" ? er.message : er)\n    }\n\n    // make sure it's valid.  we have to do this here, because\n    // couchdb will only ever say \"bad password\" with a 401 when\n    // you try to PUT a _users record that the validate_doc_update\n    // rejects for *any* reason.\n\n    if (!un) {\n      return readUsername(c, u, cb)\n    }\n\n    var error = v(un)\n    if (error) {\n      log.warn(error.message)\n      return readUsername(c, u, cb)\n    }\n\n    c.changed = c.u !== un\n    u.u = un\n    cb(er)\n  })\n}\n\nfunction readPassword (c, u, cb) {\n  var v = userValidate.pw\n\n  var prompt\n  if (c.p && !c.changed) {\n    prompt = \"Password: (or leave unchanged) \"\n  } else {\n    prompt = \"Password: \"\n  }\n\n  read({prompt: prompt, silent: true}, function (er, pw) {\n    if (er) {\n      return cb(er.message === \"cancelled\" ? er.message : er)\n    }\n\n    if (!c.changed && pw === \"\") {\n      // when the username was not changed,\n      // empty response means \"use the old value\"\n      pw = c.p\n    }\n\n    if (!pw) {\n      return readPassword(c, u, cb)\n    }\n\n    var error = v(pw)\n    if (error) {\n      log.warn(error.message)\n      return readPassword(c, u, cb)\n    }\n\n    c.changed = c.changed || c.p !== pw\n    u.p = pw\n    cb(er)\n  })\n}\n\nfunction readEmail (c, u, cb) {\n  var v = userValidate.email\n  var r = { prompt: \"Email: (this IS public) \", default: c.e || \"\" }\n  read(r, function (er, em) {\n    if (er) {\n      return cb(er.message === \"cancelled\" ? er.message : er)\n    }\n\n    if (!em) {\n      return readEmail(c, u, cb)\n    }\n\n    var error = v(em)\n    if (error) {\n      log.warn(error.message)\n      return readEmail(c, u, cb)\n    }\n\n    u.e = em\n    cb(er)\n  })\n}\n\nfunction save (c, u, cb) {\n  npm.spinner.start()\n\n  // save existing configs, but yank off for this PUT\n  var uri   = npm.config.get(\"registry\")\n  var scope = npm.config.get(\"scope\")\n\n  // there may be a saved scope and no --registry (for login)\n  if (scope) {\n    if (scope.charAt(0) !== \"@\") scope = \"@\" + scope\n\n    var scopedRegistry = npm.config.get(scope + \":registry\")\n    var cliRegistry = npm.config.get(\"registry\", \"cli\")\n    if (scopedRegistry && !cliRegistry) uri = scopedRegistry\n  }\n\n  var params = {\n    auth : {\n      username : u.u,\n      password : u.p,\n      email    : u.e\n    }\n  }\n  npm.registry.adduser(uri, params, function (er, doc) {\n    npm.spinner.stop()\n    if (er) return cb(er)\n\n    // don't want this polluting the configuration\n    npm.config.del(\"_token\", \"user\")\n\n    if (scope) npm.config.set(scope + \":registry\", uri, \"user\")\n\n    if (doc && doc.token) {\n      npm.config.setCredentialsByURI(uri, {\n        token : doc.token\n      })\n    }\n    else {\n      npm.config.setCredentialsByURI(uri, {\n        username   : u.u,\n        password   : u.p,\n        email      : u.e,\n        alwaysAuth : npm.config.get(\"always-auth\")\n      })\n    }\n\n    log.info(\"adduser\", \"Authorized user %s\", u.u)\n    npm.config.save(\"user\", cb)\n  })\n}\n"]}
{"version":3,"sources":["install.js"],"names":[],"mappings":"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","file":"install-compiled.js","sourcesContent":["// npm install <pkg> <pkg> <pkg>\n//\n// See doc/install.md for more description\n\n// Managing contexts...\n// there's a lot of state associated with an \"install\" operation, including\n// packages that are already installed, parent packages, current shrinkwrap, and\n// so on. We maintain this state in a \"context\" object that gets passed around.\n// every time we dive into a deeper node_modules folder, the \"family\" list that\n// gets passed along uses the previous \"family\" list as its __proto__.  Any\n// \"resolved precise dependency\" things that aren't already on this object get\n// added, and then that's passed to the next generation of installation.\n\nmodule.exports = install\n\ninstall.usage = \"npm install\"\n              + \"\\nnpm install <pkg>\"\n              + \"\\nnpm install <pkg>@<tag>\"\n              + \"\\nnpm install <pkg>@<version>\"\n              + \"\\nnpm install <pkg>@<version range>\"\n              + \"\\nnpm install <folder>\"\n              + \"\\nnpm install <tarball file>\"\n              + \"\\nnpm install <tarball url>\"\n              + \"\\nnpm install <git:// url>\"\n              + \"\\nnpm install <github username>/<github project>\"\n              + \"\\n\\nCan specify one or more: npm install ./foo.tgz bar@stable /some/folder\"\n              + \"\\nIf no argument is supplied and ./npm-shrinkwrap.json is \"\n              + \"\\npresent, installs dependencies specified in the shrinkwrap.\"\n              + \"\\nOtherwise, installs dependencies from ./package.json.\"\n\ninstall.completion = function (opts, cb) {\n  // install can complete to a folder with a package.json, or any package.\n  // if it has a slash, then it's gotta be a folder\n  // if it starts with https?://, then just give up, because it's a url\n  if (/^https?:\\/\\//.test(opts.partialWord)) {\n    // do not complete to URLs\n    return cb(null, [])\n  }\n\n  if (/\\//.test(opts.partialWord)) {\n    // Complete fully to folder if there is exactly one match and it\n    // is a folder containing a package.json file.  If that is not the\n    // case we return 0 matches, which will trigger the default bash\n    // complete.\n    var lastSlashIdx = opts.partialWord.lastIndexOf(\"/\")\n    var partialName = opts.partialWord.slice(lastSlashIdx + 1)\n    var partialPath = opts.partialWord.slice(0, lastSlashIdx)\n    if (partialPath === \"\") partialPath = \"/\"\n\n    function annotatePackageDirMatch (sibling, cb) {\n      var fullPath = path.join(partialPath, sibling)\n      if (sibling.slice(0, partialName.length) !== partialName) {\n        return cb(null, null) // not name match\n      }\n      fs.readdir(fullPath, function (err, contents) {\n        if (err) return cb(null, { isPackage: false })\n\n        cb(\n          null,\n          {\n            fullPath: fullPath,\n            isPackage: contents.indexOf(\"package.json\") !== -1\n          }\n        )\n      })\n    }\n\n    return fs.readdir(partialPath, function (err, siblings) {\n      if (err) return cb(null, []) // invalid dir: no matching\n\n      asyncMap(siblings, annotatePackageDirMatch, function (err, matches) {\n        if (err) return cb(err)\n\n        var cleaned = matches.filter(function (x) { return x !== null })\n        if (cleaned.length !== 1) return cb(null, [])\n        if (!cleaned[0].isPackage) return cb(null, [])\n\n        // Success - only one match and it is a package dir\n        return cb(null, [cleaned[0].fullPath])\n      })\n    })\n  }\n\n  // FIXME: there used to be registry completion here, but it stopped making\n  // sense somewhere around 50,000 packages on the registry\n  cb()\n}\n\nvar npm = require(\"./npm.js\")\n  , semver = require(\"semver\")\n  , readJson = require(\"read-package-json\")\n  , readInstalled = require(\"read-installed\")\n  , log = require(\"npmlog\")\n  , path = require(\"path\")\n  , fs = require(\"graceful-fs\")\n  , writeFileAtomic = require(\"write-file-atomic\")\n  , cache = require(\"./cache.js\")\n  , asyncMap = require(\"slide\").asyncMap\n  , chain = require(\"slide\").chain\n  , url = require(\"url\")\n  , mkdir = require(\"mkdirp\")\n  , lifecycle = require(\"./utils/lifecycle.js\")\n  , archy = require(\"archy\")\n  , npmInstallChecks = require(\"npm-install-checks\")\n  , sortedObject = require(\"sorted-object\")\n  , mapToRegistry = require(\"./utils/map-to-registry.js\")\n  , npa = require(\"npm-package-arg\")\n  , inflight = require(\"inflight\")\n  , locker = require(\"./utils/locker.js\")\n  , lock = locker.lock\n  , unlock = locker.unlock\n  , warnStrict = require(\"./utils/warn-deprecated.js\")(\"engineStrict\")\n  , warnPeers = require(\"./utils/warn-deprecated.js\")(\"peerDependencies\")\n\nfunction install (args, cb_) {\n  var hasArguments = !!args.length\n\n  function cb (er, installed) {\n    if (er) return cb_(er)\n\n    validateInstall(where, function (er, problem) {\n      if (er) return cb_(er)\n\n      if (problem) {\n        var peerInvalidError = new Error(\"The package \" + problem.name +\n          \" does not satisfy its siblings' peerDependencies requirements!\")\n        peerInvalidError.code = \"EPEERINVALID\"\n        peerInvalidError.packageName = problem.name\n        peerInvalidError.peersDepending = problem.peersDepending\n        return cb(peerInvalidError)\n      }\n\n      var tree = treeify(installed || [])\n        , pretty = prettify(tree, installed).trim()\n\n      if (pretty) console.log(pretty)\n      save(where, installed, tree, pretty, hasArguments, cb_)\n    })\n  }\n\n  // the /path/to/node_modules/..\n  var where = path.resolve(npm.dir, \"..\")\n\n  // internal api: install(where, what, cb)\n  if (arguments.length === 3) {\n    where = args\n    args = [].concat(cb_) // pass in [] to do default dep-install\n    cb_ = arguments[2]\n    log.verbose(\"install\", \"where, what\", [where, args])\n  }\n\n  if (!npm.config.get(\"global\")) {\n    args = args.filter(function (a) {\n      return path.resolve(a) !== where\n    })\n  }\n\n  mkdir(where, function (er) {\n    if (er) return cb(er)\n    // install dependencies locally by default,\n    // or install current folder globally\n    if (!args.length) {\n      var opt = { dev: npm.config.get(\"dev\") || !npm.config.get(\"production\") }\n\n      if (npm.config.get(\"global\")) args = [\".\"]\n      else return readDependencies(null, where, opt, function (er, data) {\n        if (er) {\n          log.error(\"install\", \"Couldn't read dependencies\")\n          return cb(er)\n        }\n        var deps = Object.keys(data.dependencies || {})\n        log.verbose(\"install\", \"where, deps\", [where, deps])\n\n        // FIXME: Install peerDependencies as direct dependencies, but only at\n        // the top level. Should only last until peerDependencies are nerfed to\n        // no longer implicitly install themselves.\n        var peers = []\n        Object.keys(data.peerDependencies || {}).forEach(function (dep) {\n          if (!data.dependencies[dep]) {\n            log.verbose(\n              \"install\",\n              \"peerDependency\", dep, \"wasn't going to be installed; adding\"\n            )\n            warnPeers([\n              \"The peer dependency \"+dep+\" included from \"+data.name+\" will no\",\n              \"longer be automatically installed to fulfill the peerDependency \",\n              \"in npm 3+. Your application will need to depend on it explicitly.\"\n            ], dep+\",\"+data.name)\n            peers.push(dep)\n          }\n        })\n        log.verbose(\"install\", \"where, peers\", [where, peers])\n\n        var context = { family: {}\n                      , ancestors: {}\n                      , explicit: false\n                      , parent: data\n                      , root: true\n                      , wrap: null }\n\n        if (data.name === path.basename(where) &&\n            path.basename(path.dirname(where)) === \"node_modules\") {\n          // Only include in ancestry if it can actually be required.\n          // Otherwise, it does not count.\n          context.family[data.name] =\n            context.ancestors[data.name] = data.version\n        }\n\n        installManyTop(deps.map(function (dep) {\n          var target = data.dependencies[dep]\n          return dep + \"@\" + target\n        }).concat(peers.map(function (dep) {\n          var target = data.peerDependencies[dep]\n          return dep + \"@\" + target\n        })), where, context, function(er, results) {\n          if (er || npm.config.get(\"production\")) return cb(er, results)\n          lifecycle(data, \"prepublish\", where, function(er) {\n            return cb(er, results)\n          })\n        })\n      })\n    }\n\n    // initial \"family\" is the name:version of the root, if it's got\n    // a package.json file.\n    var jsonPath = path.resolve(where, \"package.json\")\n    log.verbose('install', 'initial load of', jsonPath)\n    readJson(jsonPath, log.warn, function (er, data) {\n      if (er\n          && er.code !== \"ENOENT\"\n          && er.code !== \"ENOTDIR\") return cb(er)\n      if (er) data = null\n      var context = { family: {}\n                    , ancestors: {}\n                    , explicit: true\n                    , parent: data\n                    , root: true\n                    , wrap: null }\n      if (data && data.name === path.basename(where) &&\n          path.basename(path.dirname(where)) === \"node_modules\") {\n        context.family[data.name] = context.ancestors[data.name] = data.version\n      }\n      var fn = npm.config.get(\"global\") ? installMany : installManyTop\n      fn(args, where, context, cb)\n    })\n  })\n}\n\nfunction validateInstall (where, cb) {\n  var jsonPath = path.resolve(where, 'package.json')\n  log.verbose('validateInstall', 'loading', jsonPath, 'for validation')\n  readJson(jsonPath, log.warn, function (er, data) {\n    if (er\n        && er.code !== 'ENOENT'\n        && er.code !== 'ENOTDIR') return cb(er)\n\n    if (data && data.engineStrict) {\n      warnStrict([\n        \"Per-package engineStrict (found in this package's package.json) \",\n        \"won't be used in npm 3+. Use the config setting `engine-strict` instead.\"\n      ], data.name)\n    }\n\n    readInstalled(where, { log: log.warn, dev: true }, function (er, data) {\n      if (er) return cb(er)\n\n      cb(null, findPeerInvalid_(data.dependencies, []))\n    })\n  })\n}\n\nfunction findPeerInvalid_ (packageMap, fpiList) {\n  if (fpiList.indexOf(packageMap) !== -1)\n    return undefined\n\n  fpiList.push(packageMap)\n\n  for (var packageName in packageMap) {\n    var pkg = packageMap[packageName]\n\n    if (pkg.peerInvalid) {\n      var peersDepending = {}\n      for (var peerName in packageMap) {\n        var peer = packageMap[peerName]\n        if (peer.peerDependencies && peer.peerDependencies[packageName]) {\n          peersDepending[peer.name + \"@\" + peer.version] =\n            peer.peerDependencies[packageName]\n        }\n      }\n      return { name: pkg.name, peersDepending: peersDepending }\n    }\n\n    if (pkg.dependencies) {\n      var invalid = findPeerInvalid_(pkg.dependencies, fpiList)\n      if (invalid)\n        return invalid\n    }\n  }\n\n  return null\n}\n\n// reads dependencies for the package at \"where\". There are several cases,\n// depending on our current state and the package's configuration:\n//\n// 1. If \"context\" is specified, then we examine the context to see if there's a\n//    shrinkwrap there. In that case, dependencies are read from the shrinkwrap.\n// 2. Otherwise, if an npm-shrinkwrap.json file is present, dependencies are\n//    read from there.\n// 3. Otherwise, dependencies come from package.json.\n//\n// Regardless of which case we fall into, \"cb\" is invoked with a first argument\n// describing the full package (as though readJson had been used) but with\n// \"dependencies\" read as described above. The second argument to \"cb\" is the\n// shrinkwrap to use in processing this package's dependencies, which may be\n// \"wrap\" (in case 1) or a new shrinkwrap (in case 2).\nfunction readDependencies (context, where, opts, cb) {\n  var wrap = context ? context.wrap : null\n\n  var jsonPath = path.resolve(where, 'package.json')\n  log.verbose('readDependencies', 'loading dependencies from', jsonPath)\n  readJson(jsonPath, log.warn, function (er, data) {\n    if (er && er.code === \"ENOENT\") er.code = \"ENOPACKAGEJSON\"\n    if (er) return cb(er)\n\n    if (opts && opts.dev) {\n      if (!data.dependencies) data.dependencies = {}\n      Object.keys(data.devDependencies || {}).forEach(function (k) {\n        if (data.dependencies[k]) {\n          log.warn(\"package.json\", \"Dependency '%s' exists in both dependencies \" +\n                   \"and devDependencies, using '%s@%s' from dependencies\",\n                    k, k, data.dependencies[k])\n        } else {\n          data.dependencies[k] = data.devDependencies[k]\n        }\n      })\n    }\n\n    if (!npm.config.get(\"optional\") && data.optionalDependencies) {\n      Object.keys(data.optionalDependencies).forEach(function (d) {\n        delete data.dependencies[d]\n      })\n    }\n\n    // User has opted out of shrinkwraps entirely\n    if (npm.config.get(\"shrinkwrap\") === false)\n      return cb(null, data, null)\n\n    if (wrap) {\n      log.verbose(\"readDependencies: using existing wrap\", [where, wrap])\n      var rv = {}\n      Object.keys(data).forEach(function (key) {\n        rv[key] = data[key]\n      })\n      rv.dependencies = {}\n      Object.keys(wrap).forEach(function (key) {\n        log.verbose(\"from wrap\", [key, wrap[key]])\n        rv.dependencies[key] = readWrap(wrap[key])\n      })\n      log.verbose(\"readDependencies returned deps\", rv.dependencies)\n      return cb(null, rv, wrap)\n    }\n\n    var wrapfile = path.resolve(where, \"npm-shrinkwrap.json\")\n\n    fs.readFile(wrapfile, \"utf8\", function (er, wrapjson) {\n      if (er) return cb(null, data, null)\n\n      log.verbose(\"readDependencies\", \"npm-shrinkwrap.json is overriding dependencies\")\n      var newwrap\n      try {\n        newwrap = JSON.parse(wrapjson)\n      } catch (ex) {\n        return cb(ex)\n      }\n\n      log.info(\"shrinkwrap\", \"file %j\", wrapfile)\n      var rv = {}\n      Object.keys(data).forEach(function (key) {\n        rv[key] = data[key]\n      })\n      rv.dependencies = {}\n      Object.keys(newwrap.dependencies || {}).forEach(function (key) {\n        rv.dependencies[key] = readWrap(newwrap.dependencies[key])\n      })\n\n      // fold in devDependencies if not already present, at top level\n      if (opts && opts.dev) {\n        Object.keys(data.devDependencies || {}).forEach(function (k) {\n          rv.dependencies[k] = rv.dependencies[k] || data.devDependencies[k]\n        })\n      }\n\n      log.verbose(\"readDependencies returned deps\", rv.dependencies)\n      return cb(null, rv, newwrap.dependencies)\n    })\n  })\n}\n\nfunction readWrap (w) {\n  return (w.resolved) ? w.resolved\n       : (w.from && url.parse(w.from).protocol) ? w.from\n       : w.version\n}\n\n// if the -S|--save option is specified, then write installed packages\n// as dependencies to a package.json file.\nfunction save (where, installed, tree, pretty, hasArguments, cb) {\n  if (!hasArguments ||\n      !npm.config.get(\"save\") &&\n      !npm.config.get(\"save-dev\") &&\n      !npm.config.get(\"save-optional\") ||\n      npm.config.get(\"global\")) {\n    return cb(null, installed, tree, pretty)\n  }\n\n  var saveBundle = npm.config.get(\"save-bundle\")\n  var savePrefix = npm.config.get(\"save-prefix\")\n\n  // each item in the tree is a top-level thing that should be saved\n  // to the package.json file.\n  // The relevant tree shape is { <folder>: {what:<pkg>} }\n  var saveTarget = path.resolve(where, \"package.json\")\n\n  asyncMap(Object.keys(tree), function (k, cb) {\n    // if \"from\" is remote, git, or hosted, then save that instead.\n    var t = tree[k]\n      , f = npa(t.from)\n      , a = npa(t.what)\n      , w = [a.name, a.spec]\n\n\n    fs.stat(t.from, function (er){\n      if (!er) {\n        w[1] = \"file:\" + t.from\n      } else if (['hosted', 'git', 'remote'].indexOf(f.type) !== -1) {\n        w[1] = t.from\n      }\n      cb(null, [w])\n    })\n  }\n  , function (er, arr) {\n      var things = arr.reduce(function (set, k) {\n        var rangeDescriptor = semver.valid(k[1], true) &&\n                              semver.gte(k[1], \"0.1.0\", true) &&\n                              !npm.config.get(\"save-exact\")\n                            ? savePrefix : \"\"\n        set[k[0]] = rangeDescriptor + k[1]\n        return set\n      }, {})\n\n\n    // don't use readJson, because we don't want to do all the other\n    // tricky npm-specific stuff that's in there.\n    fs.readFile(saveTarget, function (er, data) {\n      // ignore errors here, just don't save it.\n      try {\n        data = JSON.parse(data.toString(\"utf8\"))\n      } catch (ex) {\n        er = ex\n      }\n\n      if (er) {\n        return cb(null, installed, tree, pretty)\n      }\n\n      var deps = npm.config.get(\"save-optional\") ? \"optionalDependencies\"\n               : npm.config.get(\"save-dev\") ? \"devDependencies\"\n               : \"dependencies\"\n\n      if (saveBundle) {\n        var bundle = data.bundleDependencies || data.bundledDependencies\n        delete data.bundledDependencies\n        if (!Array.isArray(bundle)) bundle = []\n        data.bundleDependencies = bundle.sort()\n      }\n\n      log.verbose(\"save\", \"saving\", things)\n      data[deps] = data[deps] || {}\n      Object.keys(things).forEach(function (t) {\n        data[deps][t] = things[t]\n        if (saveBundle) {\n          var i = bundle.indexOf(t)\n          if (i === -1) bundle.push(t)\n          data.bundleDependencies = bundle.sort()\n        }\n      })\n\n      data[deps] = sortedObject(data[deps])\n\n      log.silly(\"save\", \"writing\", saveTarget)\n      data = JSON.stringify(data, null, 2) + \"\\n\"\n      writeFileAtomic(saveTarget, data, function (er) {\n        cb(er, installed, tree, pretty)\n      })\n    })\n  })\n}\n\n\n// Outputting *all* the installed modules is a bit confusing,\n// because the length of the path does not make it clear\n// that the submodules are not immediately require()able.\n// TODO: Show the complete tree, ls-style, but only if --long is provided\nfunction prettify (tree, installed) {\n  function red (set, kv) {\n    set[kv[0]] = kv[1]\n    return set\n  }\n\n  if (npm.config.get(\"json\")) {\n    tree = Object.keys(tree).map(function (p) {\n      if (!tree[p]) return null\n      var what = npa(tree[p].what)\n        , name = what.name\n        , version = what.spec\n        , o = { name: name, version: version, from: tree[p].from }\n      o.dependencies = tree[p].children.map(function P (dep) {\n         var what = npa(dep.what)\n           , name = what.name\n           , version = what.spec\n           , o = { version: version, from: dep.from }\n         o.dependencies = dep.children.map(P).reduce(red, {})\n         return [name, o]\n       }).reduce(red, {})\n       return o\n    })\n\n    return JSON.stringify(tree, null, 2)\n  }\n  if (npm.config.get(\"parseable\")) return parseable(installed)\n\n  return Object.keys(tree).map(function (p) {\n    return archy({ label: tree[p].what + \" \" + p\n                 , nodes: (tree[p].children || []).map(function P (c) {\n                     if (npm.config.get(\"long\")) {\n                       return { label: c.what, nodes: c.children.map(P) }\n                     }\n                     var g = c.children.map(function (g) {\n                       return g.what\n                     }).join(\", \")\n                     if (g) g = \" (\" + g + \")\"\n                     return c.what + g\n                   })\n                 }, \"\", { unicode: npm.config.get(\"unicode\") })\n  }).join(\"\\n\")\n}\n\nfunction parseable (installed) {\n  var long = npm.config.get(\"long\")\n    , cwd = process.cwd()\n  return installed.map(function (item) {\n    return path.resolve(cwd, item[1]) +\n         ( long ?  \":\" + item[0] : \"\" )\n  }).join(\"\\n\")\n}\n\nfunction treeify (installed) {\n  // each item is [what, where, parent, parentDir]\n  // If no parent, then report it.\n  // otherwise, tack it into the parent's children list.\n  // If the parent isn't a top-level then ignore it.\n  var whatWhere = installed.reduce(function (l, r) {\n    var parentDir = r[3]\n      , parent = r[2]\n      , where = r[1]\n      , what = r[0]\n      , from = r[4]\n    l[where] = { parentDir: parentDir\n               , parent: parent\n               , children: []\n               , where: where\n               , what: what\n               , from: from }\n    return l\n  }, {})\n\n  // log.warn(\"install\", whatWhere, \"whatWhere\")\n  return Object.keys(whatWhere).reduce(function (l, r) {\n    var ww = whatWhere[r]\n    //log.warn(\"r, ww\", [r, ww])\n    if (!ww.parent) {\n      l[r] = ww\n    } else {\n      var p = whatWhere[ww.parentDir]\n      if (p) p.children.push(ww)\n      else l[r] = ww\n    }\n    return l\n  }, {})\n}\n\n\n// just like installMany, but also add the existing packages in\n// where/node_modules to the family object.\nfunction installManyTop (what, where, context, cb_) {\n  function cb (er, d) {\n    if (context.explicit || er) return cb_(er, d)\n    // since this wasn't an explicit install, let's build the top\n    // folder, so that `npm install` also runs the lifecycle scripts.\n    npm.commands.build([where], false, true, function (er) {\n      return cb_(er, d)\n    })\n  }\n\n  if (context.explicit) return next()\n\n  var jsonPath = path.join(where, 'package.json')\n  log.verbose('installManyTop', 'reading for lifecycle', jsonPath)\n  readJson(jsonPath, log.warn, function (er, data) {\n    if (er) return next(er)\n    lifecycle(data, \"preinstall\", where, next)\n  })\n\n  function next (er) {\n    if (er) return cb(er)\n    installManyTop_(what, where, context, cb)\n  }\n}\n\nfunction installManyTop_ (what, where, context, cb) {\n  var nm = path.resolve(where, \"node_modules\")\n\n  fs.readdir(nm, function (er, pkgs) {\n    if (er) return installMany(what, where, context, cb)\n\n    var scopes = [], unscoped = []\n    pkgs.filter(function (p) {\n      return !p.match(/^[\\._-]/)\n    }).forEach(function (p) {\n      // @names deserve deeper investigation\n      if (p[0] === \"@\") {\n        scopes.push(p)\n      }\n      else {\n        unscoped.push(p)\n      }\n    })\n\n    maybeScoped(scopes, nm, function (er, scoped) {\n      if (er && er.code !== \"ENOENT\" && er.code !== \"ENOTDIR\") return cb(er)\n      // recombine unscoped with @scope/package packages\n      asyncMap(unscoped.concat(scoped).map(function (p) {\n        return path.resolve(nm, p, \"package.json\")\n      }), function (jsonPath, cb) {\n        log.verbose('installManyTop', 'reading scoped package data from', jsonPath)\n        readJson(jsonPath, log.info, function (er, data) {\n          if (er && er.code !== \"ENOENT\" && er.code !== \"ENOTDIR\") return cb(er)\n          if (er) return cb(null, [])\n          cb(null, [[data.name, data.version]])\n        })\n      }, function (er, packages) {\n        // if there's nothing in node_modules, then don't freak out.\n        if (er) packages = []\n        // add all the existing packages to the family list.\n        // however, do not add to the ancestors list.\n        packages.forEach(function (p) {\n          context.family[p[0]] = p[1]\n        })\n        installMany(what, where, context, cb)\n      })\n    })\n  })\n}\n\nfunction maybeScoped (scopes, where, cb) {\n  // find packages in scopes\n  asyncMap(scopes, function (scope, cb) {\n    fs.readdir(path.resolve(where, scope), function (er, scoped) {\n      if (er) return cb(er)\n      var paths = scoped.map(function (p) {\n        return path.join(scope, p)\n      })\n      cb(null, paths)\n    })\n  }, cb)\n}\n\nfunction installMany (what, where, context, cb) {\n  // readDependencies takes care of figuring out whether the list of\n  // dependencies we'll iterate below comes from an existing shrinkwrap from a\n  // parent level, a new shrinkwrap at this level, or package.json at this\n  // level, as well as which shrinkwrap (if any) our dependencies should use.\n  var opt = { dev: npm.config.get(\"dev\") }\n  readDependencies(context, where, opt, function (er, data, wrap) {\n    if (er) data = {}\n\n    var parent = data\n\n    // if we're explicitly installing \"what\" into \"where\", then the shrinkwrap\n    // for \"where\" doesn't apply. This would be the case if someone were adding\n    // a new package to a shrinkwrapped package. (data.dependencies will not be\n    // used here except to indicate what packages are already present, so\n    // there's no harm in using that.)\n    if (context.explicit) wrap = null\n\n    var deps = data.dependencies || {}\n    var devDeps = data.devDependencies || {}\n\n    // what is a list of things.\n    // resolve each one.\n    asyncMap( what\n            , targetResolver(where, context, deps, devDeps)\n            , function (er, targets) {\n\n      if (er) return cb(er)\n\n      var bundled = data.bundleDependencies || data.bundledDependencies || []\n      // only take the hit for readInstalled if there are probably bundled\n      // dependencies to read\n      if (bundled.length) {\n        readInstalled(where, { dev: true }, andBuildResolvedTree)\n      } else {\n        andBuildResolvedTree()\n      }\n\n      function andBuildResolvedTree (er, current) {\n        if (er) return cb(er)\n\n        // each target will be a data object corresponding\n        // to a package, folder, or whatever that is in the cache now.\n        var newPrev = Object.create(context.family)\n          , newAnc = Object.create(context.ancestors)\n\n        if (!context.root) {\n          newAnc[data.name] = data.version\n        }\n        bundled.forEach(function (bundle) {\n          var bundleData = current.dependencies[bundle]\n          if ((!bundleData || !bundleData.version) && current.devDependencies) {\n            log.verbose(\n              'installMany', bundle, 'was bundled with',\n              data.name + '@' + data.version +\n                \", but wasn't found in dependencies. Trying devDependencies\"\n            )\n            bundleData = current.devDependencies[bundle]\n          }\n\n          if (!bundleData || !bundleData.version) {\n            log.warn(\n              'installMany', bundle, 'was bundled with',\n              data.name + '@' + data.version +\n                \", but bundled package wasn't found in unpacked tree\"\n            )\n          } else {\n            log.verbose(\n              'installMany', bundle + '@' + bundleData.version,\n              'was bundled with', data.name + '@' + data.version\n            )\n            newPrev[bundle] = bundleData.version\n          }\n        })\n        targets.forEach(function (t) {\n          newPrev[t.name] = t.version\n        })\n        log.silly(\"install resolved\", targets)\n        targets.filter(function (t) { return t }).forEach(function (t) {\n          log.info(\"install\", \"%s into %s\", t._id, where)\n        })\n        asyncMap(targets, function (target, cb) {\n          log.info(\"installOne\", target._id)\n          var wrapData = wrap ? wrap[target.name] : null\n          var newWrap = wrapData && wrapData.dependencies\n                      ? wrap[target.name].dependencies || {}\n                      : null\n          var newContext = { family: newPrev\n                           , ancestors: newAnc\n                           , parent: parent\n                           , explicit: false\n                           , wrap: newWrap }\n          installOne(target, where, newContext, cb)\n        }, cb)\n      }\n    })\n  })\n}\n\nfunction targetResolver (where, context, deps, devDeps) {\n  var alreadyInstalledManually = []\n    , resolveLeft = 0\n    , nm = path.resolve(where, \"node_modules\")\n    , parent = context.parent\n    , wrap = context.wrap\n\n  if (!context.explicit) readdir(nm)\n\n  function readdir(name) {\n    resolveLeft++\n    fs.readdir(name, function (er, inst) {\n      if (er) return resolveLeft--\n\n      // don't even mess with non-package looking things\n      inst = inst.filter(function (p) {\n        if (!p.match(/^[@\\._-]/)) return true\n        // scoped packages\n        readdir(path.join(name, p))\n      })\n\n      asyncMap(inst, function (pkg, cb) {\n        var jsonPath = path.resolve(name, pkg, 'package.json')\n        log.verbose('targetResolver', 'reading package data from', jsonPath)\n        readJson(jsonPath, log.info, function (er, d) {\n          if (er && er.code !== \"ENOENT\" && er.code !== \"ENOTDIR\") return cb(er)\n          // error means it's not a package, most likely.\n          if (er) return cb(null, [])\n\n          // if it's a bundled dep, then assume that anything there is valid.\n          // otherwise, make sure that it's a semver match with what we want.\n          var bd = parent.bundleDependencies\n          var isBundled = bd && bd.indexOf(d.name) !== -1\n          var expectedVersion = deps[d.name] || (devDeps && devDeps[d.name]) || \"*\"\n          var currentIsSatisfactory = semver.satisfies(d.version, expectedVersion, true)\n          if (isBundled || currentIsSatisfactory || deps[d.name] === d._resolved) {\n            return cb(null, d.name)\n          }\n\n          // see if the package had been previously linked\n          fs.lstat(path.resolve(nm, pkg), function(err, s) {\n            if (err) return cb(null, [])\n            if (s.isSymbolicLink()) {\n              return cb(null, d.name)\n            }\n\n            // something is there, but it's not satisfactory.  Clobber it.\n            return cb(null, [])\n          })\n        })\n      }, function (er, inst) {\n        // this is the list of things that are valid and should be ignored.\n        alreadyInstalledManually = alreadyInstalledManually.concat(inst)\n        resolveLeft--\n      })\n    })\n  }\n\n  var to = 0\n  return function resolver (what, cb) {\n    if (resolveLeft) return setTimeout(function () {\n      resolver(what, cb)\n    }, to++)\n\n    // now we know what's been installed here manually,\n    // or tampered with in some way that npm doesn't want to overwrite.\n    if (alreadyInstalledManually.indexOf(npa(what).name) !== -1) {\n      log.verbose(\"already installed\", \"skipping %s %s\", what, where)\n      return cb(null, [])\n    }\n\n    // check for a version installed higher in the tree.\n    // If installing from a shrinkwrap, it must match exactly.\n    if (context.family[what]) {\n      log.verbose('install', what, 'is installed as', context.family[what])\n      if (wrap && wrap[what].version === context.family[what]) {\n        log.verbose(\"shrinkwrap\", \"use existing\", what)\n        return cb(null, [])\n      }\n    }\n\n    // if it's identical to its parent, then it's probably someone\n    // doing `npm install foo` inside of the foo project.  Print\n    // a warning, and skip it.\n    if (parent && parent.name === what && !npm.config.get(\"force\")) {\n      log.warn(\"install\", \"Refusing to install %s as a dependency of itself\"\n              , what)\n      return cb(null, [])\n    }\n\n    if (wrap) {\n      var name = npa(what).name\n      if (wrap[name]) {\n        var wrapTarget = readWrap(wrap[name])\n        what = name + \"@\" + wrapTarget\n      } else {\n        log.verbose(\"shrinkwrap\", \"skipping %s (not in shrinkwrap)\", what)\n      }\n    } else if (deps[what]) {\n      what = what + \"@\" + deps[what]\n    }\n\n    // This is where we actually fetch the package, if it's not already\n    // in the cache.\n    // If it's a git repo, then we want to install it, even if the parent\n    // already has a matching copy.\n    // If it's not a git repo, and the parent already has that pkg, then\n    // we can skip installing it again.\n    var pkgroot = path.resolve(npm.prefix, (parent && parent._from) || \"\")\n    cache.add(what, null, pkgroot, false, function (er, data) {\n      if (er && parent && parent.optionalDependencies &&\n          parent.optionalDependencies.hasOwnProperty(npa(what).name)) {\n        log.warn(\"optional dep failed, continuing\", what)\n        log.verbose(\"optional dep failed, continuing\", [what, er])\n        return cb(null, [])\n      }\n\n      var type = npa(what).type\n      var isGit = type === \"git\" || type === \"hosted\"\n\n      if (!er &&\n          data &&\n          !context.explicit &&\n          context.family[data.name] === data.version &&\n          !npm.config.get(\"force\") &&\n          !isGit) {\n        log.info(\"already installed\", data.name + \"@\" + data.version)\n        return cb(null, [])\n      }\n\n\n      if (data && !data._from) data._from = what\n      if (er && parent && parent.name) er.parent = parent.name\n      return cb(er, data || [])\n    })\n  }\n}\n\n// we've already decided to install this.  if anything's in the way,\n// then uninstall it first.\nfunction installOne (target, where, context, cb) {\n  // the --link flag makes this a \"link\" command if it's at the\n  // the top level.\n  var isGit = false\n  var type = npa(target._from).type\n  if (target && target._from) isGit = type === 'git' || type === 'hosted'\n\n  if (where === npm.prefix && npm.config.get(\"link\")\n      && !npm.config.get(\"global\") && !isGit) {\n    return localLink(target, where, context, cb)\n  }\n  installOne_(target, where, context, function (er, installedWhat) {\n\n    // check if this one is optional to its parent.\n    if (er && context.parent && context.parent.optionalDependencies &&\n        context.parent.optionalDependencies.hasOwnProperty(target.name)) {\n      log.warn(\"optional dep failed, continuing\", target._id)\n      log.verbose(\"optional dep failed, continuing\", [target._id, er])\n      er = null\n    }\n\n    cb(er, installedWhat)\n  })\n\n}\n\nfunction localLink (target, where, context, cb) {\n  log.verbose(\"localLink\", target._id)\n  var jsonPath = path.resolve(npm.globalDir, target.name , 'package.json')\n  var parent = context.parent\n\n  log.verbose('localLink', 'reading data to link', target.name, 'from', jsonPath)\n  readJson(jsonPath, log.warn, function (er, data) {\n    function thenLink () {\n      npm.commands.link([target.name], function (er, d) {\n        log.silly(\"localLink\", \"back from link\", [er, d])\n        cb(er, [resultList(target, where, parent && parent._id)])\n      })\n    }\n\n    if (er && er.code !== \"ENOENT\" && er.code !== \"ENOTDIR\") return cb(er)\n    if (er || data._id === target._id) {\n      if (er) {\n        install( path.resolve(npm.globalDir, \"..\")\n               , target._id\n               , function (er) {\n          if (er) return cb(er, [])\n          thenLink()\n        })\n      } else thenLink()\n    } else {\n      log.verbose(\"localLink\", \"install locally (no link)\", target._id)\n      installOne_(target, where, context, cb)\n    }\n  })\n}\n\nfunction resultList (target, where, parentId) {\n  var nm = path.resolve(where, \"node_modules\")\n    , targetFolder = path.resolve(nm, target.name)\n    , prettyWhere = where\n\n  if (!npm.config.get(\"global\")) {\n    prettyWhere = path.relative(process.cwd(), where)\n  }\n\n  if (prettyWhere === \".\") prettyWhere = null\n\n  if (!npm.config.get(\"global\")) {\n    // print out the folder relative to where we are right now.\n    targetFolder = path.relative(process.cwd(), targetFolder)\n  }\n\n  return [ target._id\n         , targetFolder\n         , prettyWhere && parentId\n         , parentId && prettyWhere\n         , target._from ]\n}\n\nvar installed = Object.create(null)\n\nfunction installOne_ (target, where, context, cb_) {\n  var nm = path.resolve(where, \"node_modules\")\n    , targetFolder = path.resolve(nm, target.name)\n    , prettyWhere = path.relative(process.cwd(), where)\n    , parent = context.parent\n\n  if (prettyWhere === \".\") prettyWhere = null\n\n  cb_ = inflight(target.name + \":\" + where, cb_)\n  if (!cb_) {\n    return log.verbose(\"installOne\", \"of\", target.name, \"to\", where, \"already in flight; waiting\")\n  }\n  else {\n    log.verbose(\"installOne\", \"of\", target.name, \"to\", where, \"not in flight; installing\")\n  }\n\n  function cb(er, data) {\n    unlock(nm, target.name, function () { cb_(er, data) })\n  }\n\n  lock(nm, target.name, function (er) {\n    if (er) return cb(er)\n\n    if (targetFolder in installed) {\n      log.error(\"install\", \"trying to install\", target.version, \"to\", targetFolder)\n      log.error(\"install\", \"but already installed versions\", installed[targetFolder])\n      installed[targetFolder].push(target.version)\n    }\n    else {\n      installed[targetFolder] = [target.version]\n    }\n\n    var force = npm.config.get(\"force\")\n      , nodeVersion = npm.config.get(\"node-version\")\n      , strict = npm.config.get(\"engine-strict\")\n      , c = npmInstallChecks\n\n    chain(\n        [ [c.checkEngine, target, npm.version, nodeVersion, force, strict]\n        , [c.checkPlatform, target, force]\n        , [c.checkCycle, target, context.ancestors]\n        , [c.checkGit, targetFolder]\n        , [write, target, targetFolder, context] ]\n      , function (er, d) {\n          if (er) return cb(er)\n\n          d.push(resultList(target, where, parent && parent._id))\n          cb(er, d)\n        }\n      )\n  })\n}\n\nfunction write (target, targetFolder, context, cb_) {\n  var up = npm.config.get(\"unsafe-perm\")\n    , user = up ? null : npm.config.get(\"user\")\n    , group = up ? null : npm.config.get(\"group\")\n    , family = context.family\n\n  function cb (er, data) {\n    // cache.unpack returns the data object, and all we care about\n    // is the list of installed packages from that last thing.\n    if (!er) return cb_(er, data)\n\n    if (npm.config.get(\"rollback\") === false) return cb_(er)\n    npm.rollbacks.push(targetFolder)\n    cb_(er, data)\n  }\n\n  var bundled = []\n\n  log.silly(\"install write\", \"writing\", target.name, target.version, \"to\", targetFolder)\n  chain(\n    [ [ cache.unpack, target.name, target.version, targetFolder, null, null, user, group ],\n      function writePackageJSON (cb) {\n        var jsonPath = path.resolve(targetFolder, 'package.json')\n        log.verbose('write', 'writing to', jsonPath)\n        writeFileAtomic(jsonPath, JSON.stringify(target, null, 2) + '\\n', cb)\n      },\n      [ lifecycle, target, \"preinstall\", targetFolder ],\n      function collectBundled (cb) {\n        if (!target.bundleDependencies) return cb()\n\n        var bd = path.resolve(targetFolder, \"node_modules\")\n        fs.readdir(bd, function (er, b) {\n          // nothing bundled, maybe\n          if (er) return cb()\n          bundled = b || []\n          cb()\n        })\n      } ]\n\n    // nest the chain so that we can throw away the results returned\n    // up until this point, since we really don't care about it.\n    , function X (er) {\n      if (er) return cb(er)\n\n      // before continuing to installing dependencies, check for a shrinkwrap.\n      var opt = { dev: npm.config.get(\"dev\") }\n      readDependencies(context, targetFolder, opt, function (er, data, wrap) {\n        if (er) return cb(er);\n        var deps = prepareForInstallMany(data, \"dependencies\", bundled, wrap,\n            family)\n        var depsTargetFolder = targetFolder\n        var depsContext = { family: family\n                          , ancestors: context.ancestors\n                          , parent: target\n                          , explicit: false\n                          , wrap: wrap }\n\n        var actions =\n          [ [ installManyAndBuild, deps, depsTargetFolder, depsContext ] ]\n\n        // FIXME: This is an accident waiting to happen!\n        //\n        // 1. If multiple children at the same level of the tree share a\n        //    peerDependency that's not in the parent's dependencies, because\n        //    the peerDeps don't get added to the family, they will keep\n        //    getting reinstalled (worked around by inflighting installOne).\n        // 2. The installer can't safely build at the parent level because\n        //    that's already being done by the parent's installAndBuild. This\n        //    runs the risk of the peerDependency never getting built.\n        //\n        //  The fix: Don't install peerDependencies; require them to be\n        //  included as explicit dependencies / devDependencies, and warn\n        //  or error when they're missing. See #5080 for more arguments in\n        //  favor of killing implicit peerDependency installs with fire.\n        var peerDeps = prepareForInstallMany(data, \"peerDependencies\", bundled,\n            wrap, family)\n        peerDeps.forEach(function (pd) {\n            warnPeers([\n              \"The peer dependency \"+pd+\" included from \"+data.name+\" will no\",\n              \"longer be automatically installed to fulfill the peerDependency \",\n              \"in npm 3+. Your application will need to depend on it explicitly.\"\n            ], pd+\",\"+data.name)\n        })\n\n        // Package scopes cause an addditional tree level which needs to be\n        // considered when resolving a peerDependency's target folder.\n        var pdTargetFolder\n        if (npa(target.name).scope) {\n          pdTargetFolder = path.resolve(targetFolder, '../../..')\n        } else {\n          pdTargetFolder = path.resolve(targetFolder, '../..')\n        }\n\n        var pdContext = context\n        if (peerDeps.length > 0) {\n          actions.push(\n            [ installMany, peerDeps, pdTargetFolder, pdContext ]\n          )\n        }\n\n        chain(actions, cb)\n      })\n    })\n}\n\nfunction installManyAndBuild (deps, targetFolder, context, cb) {\n  installMany(deps, targetFolder, context, function (er, d) {\n    log.verbose(\"about to build\", targetFolder)\n    if (er) return cb(er)\n    npm.commands.build( [targetFolder]\n                      , npm.config.get(\"global\")\n                      , true\n                      , function (er) { return cb(er, d) })\n  })\n}\n\nfunction prepareForInstallMany (packageData, depsKey, bundled, wrap, family) {\n  var deps = Object.keys(packageData[depsKey] || {})\n\n  // don't install bundleDependencies, unless they're missing.\n  if (packageData.bundleDependencies) {\n    deps = deps.filter(function (d) {\n      return packageData.bundleDependencies.indexOf(d) === -1 ||\n             bundled.indexOf(d) === -1\n    })\n  }\n\n  return deps.filter(function (d) {\n    // prefer to not install things that are satisfied by\n    // something in the \"family\" list, unless we're installing\n    // from a shrinkwrap.\n    if (wrap) return wrap\n    if (semver.validRange(family[d], true)) {\n      return !semver.satisfies(family[d], packageData[depsKey][d], true)\n    }\n    return true\n  }).map(function (d) {\n    var v = packageData[depsKey][d]\n    var t = d + \"@\" + v\n    log.silly(\"prepareForInstallMany\", \"adding\", t, \"from\", packageData.name, depsKey)\n    return t\n  })\n}\n"]}
{"version":3,"sources":["prune.js"],"names":[],"mappings":";;;;AAEA,MAAM,CAAC,OAAO,GAAG,KAAK,CAAA;;AAEtB,KAAK,CAAC,KAAK,GAAG,WAAW,CAAA;;AAEzB,IAAI,aAAa,GAAG,OAAO,CAAC,gBAAgB,CAAC;IACzC,GAAG,GAAG,OAAO,CAAC,UAAU,CAAC;IACzB,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC;IACtB,QAAQ,GAAG,OAAO,CAAC,mBAAmB,CAAC;IACvC,GAAG,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAA;;AAE3B,KAAK,CAAC,UAAU,GAAG,OAAO,CAAC,sCAAsC,CAAC,CAAA;;AAElE,SAAS,KAAK,CAAE,IAAI,EAAE,EAAE,EAAE;;AAExB,MAAI,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,EAAE,IAAI,EAAE,cAAc,CAAE,CAAA;AAC3D,UAAQ,CAAC,QAAQ,EAAE,GAAG,CAAC,IAAI,EAAE,UAAU,EAAE,EAAE;AACzC,QAAI,EAAE,EAAE,OAAO,EAAE,CAAC,EAAE,CAAC,CAAA;AACrB,QAAI,EAAE,CAAA;GACP,CAAC,CAAA;;AAEF,WAAS,IAAI,GAAG;AACd,QAAI,GAAG,GAAG;AACR,WAAK,EAAE,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC;AAC9B,SAAG,EAAE,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,YAAY,CAAC,IAAI,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC;KAC5D,CAAA;AACD,iBAAa,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,UAAU,EAAE,EAAE,IAAI,EAAE;AACjD,UAAI,EAAE,EAAE,OAAO,EAAE,CAAC,EAAE,CAAC,CAAA;AACrB,YAAM,CAAC,IAAI,EAAE,IAAI,EAAE,EAAE,CAAC,CAAA;KACvB,CAAC,CAAA;GACH;CACF;;AAED,SAAS,MAAM,CAAE,IAAI,EAAE,IAAI,EAAE,EAAE,EAAE;AAC/B,KAAG,CAAC,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,EAAE,IAAI,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC,CAAA;CACpD;;AAED,SAAS,SAAS,CAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE;AACpC,MAAI,IAAI,GAAG,IAAI,CAAC,YAAY,IAAI,EAAE,CAAA;AAClC,SAAO,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,UAAU,CAAC,EAAE;AACxC,QAAI,OAAO,IAAI,CAAC,CAAC,CAAC,KAAK,QAAQ,IACxB,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,OAAO,IAAI,CAAA;AAChD,QAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAA;AAClB,QAAI,IAAI,CAAC,CAAC,CAAC,CAAC,UAAU,KACd,IAAI,CAAC,MAAM,KAAK,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAA,AAAC,EAAE;AACpD,UAAI,KAAK,GAAG,IAAI,CAAC,CAAC,CAAC,CAAA;AACnB,aAAO,IAAI,CAAC,CAAC,CAAC,CAAA;AACd,aAAO,KAAK,CAAC,IAAI,CAAA;KAClB;AACD,WAAO,SAAS,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAA;GACtC,CAAC,CAAC,MAAM,CAAC,UAAU,CAAC,EAAE;AAAE,WAAO,CAAC,KAAK,IAAI,CAAA;GAAE,CAAC,CAC5C,MAAM,CAAC,SAAS,IAAI,CAAE,CAAC,EAAE,CAAC,EAAE;AAC3B,WAAO,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,IAAI,EAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAA;GAC1D,EAAE,EAAE,CAAC,CAAA;CACP","file":"prune-compiled.js","sourcesContent":["// prune extraneous packages.\n\nmodule.exports = prune\n\nprune.usage = \"npm prune\"\n\nvar readInstalled = require(\"read-installed\")\n  , npm = require(\"./npm.js\")\n  , path = require(\"path\")\n  , readJson = require(\"read-package-json\")\n  , log = require(\"npmlog\")\n\nprune.completion = require(\"./utils/completion/installed-deep.js\")\n\nfunction prune (args, cb) {\n  //check if is a valid package.json file\n  var jsonFile = path.resolve(npm.dir, \"..\", \"package.json\" )\n  readJson(jsonFile, log.warn, function (er) {\n    if (er) return cb(er)\n    next()\n  })\n\n  function next() {\n    var opt = {\n      depth: npm.config.get(\"depth\"),\n      dev: !npm.config.get(\"production\") || npm.config.get(\"dev\")\n    }\n    readInstalled(npm.prefix, opt, function (er, data) {\n      if (er) return cb(er)\n      prune_(args, data, cb)\n    })\n  }\n}\n\nfunction prune_ (args, data, cb) {\n  npm.commands.unbuild(prunables(args, data, []), cb)\n}\n\nfunction prunables (args, data, seen) {\n  var deps = data.dependencies || {}\n  return Object.keys(deps).map(function (d) {\n    if (typeof deps[d] !== \"object\"\n        || seen.indexOf(deps[d]) !== -1) return null\n    seen.push(deps[d])\n    if (deps[d].extraneous\n        && (args.length === 0 || args.indexOf(d) !== -1)) {\n      var extra = deps[d]\n      delete deps[d]\n      return extra.path\n    }\n    return prunables(args, deps[d], seen)\n  }).filter(function (d) { return d !== null })\n  .reduce(function FLAT (l, r) {\n    return l.concat(Array.isArray(r) ? r.reduce(FLAT,[]) : r)\n  }, [])\n}\n"]}
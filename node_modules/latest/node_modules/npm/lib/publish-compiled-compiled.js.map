{"version":3,"sources":["publish-compiled.js"],"names":[],"mappings":"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","file":"publish-compiled-compiled.js","sourcesContent":["\"use strict\";\n\nmodule.exports = publish;\n\nvar npm = require(\"./npm.js\"),\n    log = require(\"npmlog\"),\n    path = require(\"path\"),\n    readJson = require(\"read-package-json\"),\n    lifecycle = require(\"./utils/lifecycle.js\"),\n    chain = require(\"slide\").chain,\n    mapToRegistry = require(\"./utils/map-to-registry.js\"),\n    cachedPackageRoot = require(\"./cache/cached-package-root.js\"),\n    createReadStream = require(\"graceful-fs\").createReadStream,\n    npa = require(\"npm-package-arg\"),\n    semver = require(\"semver\"),\n    getPublishConfig = require(\"./utils/get-publish-config.js\");\n\npublish.usage = \"npm publish <tarball> [--tag <tagname>]\" + \"\\nnpm publish <folder> [--tag <tagname>]\" + \"\\n\\nPublishes '.' if no argument supplied\" + \"\\n\\nSets tag `latest` if no --tag specified\";\n\npublish.completion = function (opts, cb) {\n  // publish can complete to a folder with a package.json\n  // or a tarball, or a tarball url.\n  // for now, not yet implemented.\n  return cb();\n};\n\nfunction publish(args, isRetry, cb) {\n  if (typeof cb !== \"function\") {\n    cb = isRetry;\n    isRetry = false;\n  }\n  if (args.length === 0) args = [\".\"];\n  if (args.length !== 1) return cb(publish.usage);\n\n  log.verbose(\"publish\", args);\n\n  var t = npm.config.get(\"tag\").trim();\n  if (semver.validRange(t)) {\n    var er = new Error(\"Tag name must not be a valid SemVer range: \" + t);\n    return cb(er);\n  }\n\n  var arg = args[0];\n  // if it's a local folder, then run the prepublish there, first.\n  readJson(path.resolve(arg, \"package.json\"), function (er, data) {\n    if (er && er.code !== \"ENOENT\" && er.code !== \"ENOTDIR\") return cb(er);\n\n    if (data) {\n      if (!data.name) return cb(new Error(\"No name provided\"));\n      if (!data.version) return cb(new Error(\"No version provided\"));\n    }\n\n    // Error is OK. Could be publishing a URL or tarball, however, that means\n    // that we will not have automatically run the prepublish script, since\n    // that gets run when adding a folder to the cache.\n    if (er) return cacheAddPublish(arg, false, isRetry, cb);else cacheAddPublish(arg, true, isRetry, cb);\n  });\n}\n\n// didPre in this case means that we already ran the prepublish script,\n// and that the \"dir\" is an actual directory, and not something silly\n// like a tarball or name@version thing.\n// That means that we can run publish/postpublish in the dir, rather than\n// in the cache dir.\nfunction cacheAddPublish(dir, didPre, isRetry, cb) {\n  npm.commands.cache.add(dir, null, null, false, function (er, data) {\n    if (er) return cb(er);\n    log.silly(\"publish\", data);\n    var cachedir = path.resolve(cachedPackageRoot(data), \"package\");\n    chain([!didPre && [lifecycle, data, \"prepublish\", cachedir], [publish_, dir, data, isRetry, cachedir], [lifecycle, data, \"publish\", didPre ? dir : cachedir], [lifecycle, data, \"postpublish\", didPre ? dir : cachedir]], cb);\n  });\n}\n\nfunction publish_(arg, data, isRetry, cachedir, cb) {\n  if (!data) return cb(new Error(\"no package.json file found\"));\n\n  var mappedConfig = getPublishConfig(data.publishConfig, npm.config, npm.registry);\n  var config = mappedConfig.config;\n  var registry = mappedConfig.client;\n\n  data._npmVersion = npm.version;\n  data._nodeVersion = process.versions.node;\n\n  delete data.modules;\n  if (data[\"private\"]) return cb(new Error(\"This package has been marked as private\\n\" + \"Remove the 'private' field from the package.json to publish it.\"));\n\n  mapToRegistry(data.name, config, function (er, registryURI, auth, registryBase) {\n    if (er) return cb(er);\n\n    var tarballPath = cachedir + \".tgz\";\n\n    // we just want the base registry URL in this case\n    log.verbose(\"publish\", \"registryBase\", registryBase);\n    log.silly(\"publish\", \"uploading\", tarballPath);\n\n    data._npmUser = {\n      name: auth.username,\n      email: auth.email\n    };\n\n    var params = {\n      metadata: data,\n      body: createReadStream(tarballPath),\n      auth: auth\n    };\n\n    // registry-frontdoor cares about the access level, which is only\n    // configurable for scoped packages\n    if (config.get(\"access\")) {\n      if (!npa(data.name).scope && config.get(\"access\") === \"restricted\") {\n        return cb(new Error(\"Can't restrict access to unscoped packages.\"));\n      }\n\n      params.access = config.get(\"access\");\n    }\n\n    registry.publish(registryBase, params, function (er) {\n      if (er && er.code === \"EPUBLISHCONFLICT\" && npm.config.get(\"force\") && !isRetry) {\n        log.warn(\"publish\", \"Forced publish over \" + data._id);\n        return npm.commands.unpublish([data._id], function (er) {\n          // ignore errors.  Use the force.  Reach out with your feelings.\n          // but if it fails again, then report the first error.\n          publish([arg], er || true, cb);\n        });\n      }\n      // report the unpublish error if this was a retry and unpublish failed\n      if (er && isRetry && isRetry !== true) return cb(isRetry);\n      if (er) return cb(er);\n      console.log(\"+ \" + data._id);\n      cb();\n    });\n  });\n}\n\n//# sourceMappingURL=publish-compiled.js.map"]}
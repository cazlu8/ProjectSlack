{"version":3,"sources":["dedupe.js"],"names":[],"mappings":"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","file":"dedupe-compiled.js","sourcesContent":["// traverse the node_modules/package.json tree\n// looking for duplicates.  If any duplicates are found,\n// then move them up to the highest level necessary\n// in order to make them no longer duplicated.\n//\n// This is kind of ugly, and really highlights the need for\n// much better \"put pkg X at folder Y\" abstraction.  Oh well,\n// whatever.  Perfect enemy of the good, and all that.\n\nvar fs = require(\"fs\")\nvar asyncMap = require(\"slide\").asyncMap\nvar path = require(\"path\")\nvar readJson = require(\"read-package-json\")\nvar semver = require(\"semver\")\nvar rm = require(\"./utils/gently-rm.js\")\nvar log = require(\"npmlog\")\nvar npm = require(\"./npm.js\")\nvar mapToRegistry = require(\"./utils/map-to-registry.js\")\n\nmodule.exports = dedupe\n\ndedupe.usage = \"npm dedupe [pkg pkg...]\"\n\nfunction dedupe (args, silent, cb) {\n  if (typeof silent === \"function\") cb = silent, silent = false\n  var dryrun = false\n  if (npm.command.match(/^find/)) dryrun = true\n  return dedupe_(npm.prefix, args, {}, dryrun, silent, cb)\n}\n\nfunction dedupe_ (dir, filter, unavoidable, dryrun, silent, cb) {\n  readInstalled(path.resolve(dir), {}, null, function (er, data, counter) {\n    if (er) {\n      return cb(er)\n    }\n\n    if (!data) {\n      return cb()\n    }\n\n    // find out which things are dupes\n    var dupes = Object.keys(counter || {}).filter(function (k) {\n      if (filter.length && -1 === filter.indexOf(k)) return false\n      return counter[k] > 1 && !unavoidable[k]\n    }).reduce(function (s, k) {\n      s[k] = []\n      return s\n    }, {})\n\n    // any that are unavoidable need to remain as they are.  don't even\n    // try to touch them or figure it out.  Maybe some day, we can do\n    // something a bit more clever here, but for now, just skip over it,\n    // and all its children.\n    ;(function U (obj) {\n      if (unavoidable[obj.name]) {\n        obj.unavoidable = true\n      }\n      if (obj.parent && obj.parent.unavoidable) {\n        obj.unavoidable = true\n      }\n      Object.keys(obj.children).forEach(function (k) {\n        U(obj.children[k])\n      })\n    })(data)\n\n    // then collect them up and figure out who needs them\n    ;(function C (obj) {\n      if (dupes[obj.name] && !obj.unavoidable) {\n        dupes[obj.name].push(obj)\n        obj.duplicate = true\n      }\n      obj.dependents = whoDepends(obj)\n      Object.keys(obj.children).forEach(function (k) {\n        C(obj.children[k])\n      })\n    })(data)\n\n    if (dryrun) {\n      var k = Object.keys(dupes)\n      if (!k.length) return cb()\n      return npm.commands.ls(k, silent, cb)\n    }\n\n    var summary = Object.keys(dupes).map(function (n) {\n      return [n, dupes[n].filter(function (d) {\n        return d && d.parent && !d.parent.duplicate && !d.unavoidable\n      }).map(function M (d) {\n        return [d.path, d.version, d.dependents.map(function (k) {\n          return [k.path, k.version, k.dependencies[d.name] || \"\"]\n        })]\n      })]\n    }).map(function (item) {\n      var set = item[1]\n\n      var ranges = set.map(function (i) {\n        return i[2].map(function (d) {\n          return d[2]\n        })\n      }).reduce(function (l, r) {\n        return l.concat(r)\n      }, []).map(function (v, i, set) {\n        if (set.indexOf(v) !== i) return false\n        return v\n      }).filter(function (v) {\n        return v !== false\n      })\n\n      var locs = set.map(function (i) {\n        return i[0]\n      })\n\n      var versions = set.map(function (i) {\n        return i[1]\n      }).filter(function (v, i, set) {\n        return set.indexOf(v) === i\n      })\n\n      var has = set.map(function (i) {\n        return [i[0], i[1]]\n      }).reduce(function (set, kv) {\n        set[kv[0]] = kv[1]\n        return set\n      }, {})\n\n      var loc = locs.length ? locs.reduce(function (a, b) {\n        // a=/path/to/node_modules/foo/node_modules/bar\n        // b=/path/to/node_modules/elk/node_modules/bar\n        // ==/path/to/node_modules/bar\n        var nmReg = new RegExp(\"\\\\\" + path.sep + \"node_modules\\\\\" + path.sep)\n        a = a.split(nmReg)\n        b = b.split(nmReg)\n        var name = a.pop()\n        b.pop()\n        // find the longest chain that both A and B share.\n        // then push the name back on it, and join by /node_modules/\n        for (var i = 0, al = a.length, bl = b.length; i < al && i < bl && a[i] === b[i]; i++);\n        return a.slice(0, i).concat(name).join(path.sep + \"node_modules\" + path.sep)\n      }) : undefined\n\n      return [item[0], { item: item\n                       , ranges: ranges\n                       , locs: locs\n                       , loc: loc\n                       , has: has\n                       , versions: versions\n                       }]\n    }).filter(function (i) {\n      return i[1].loc\n    })\n\n    findVersions(npm, summary, function (er, set) {\n      if (er) return cb(er)\n      if (!set.length) return cb()\n      installAndRetest(set, filter, dir, unavoidable, silent, cb)\n    })\n  })\n}\n\nfunction installAndRetest (set, filter, dir, unavoidable, silent, cb) {\n  //return cb(null, set)\n  var remove = []\n\n  asyncMap(set, function (item, cb) {\n    // [name, has, loc, locMatch, regMatch, others]\n    var name = item[0]\n    var has = item[1]\n    var where = item[2]\n    var locMatch = item[3]\n    var regMatch = item[4]\n    var others = item[5]\n\n    // nothing to be done here.  oh well.  just a conflict.\n    if (!locMatch && !regMatch) {\n      log.warn(\"unavoidable conflict\", item[0], item[1])\n      log.warn(\"unavoidable conflict\", \"Not de-duplicating\")\n      unavoidable[item[0]] = true\n      return cb()\n    }\n\n    // nothing to do except to clean up the extraneous deps\n    if (locMatch && has[where] === locMatch) {\n      remove.push.apply(remove, others)\n      return cb()\n    }\n\n    if (regMatch) {\n      var what = name + \"@\" + regMatch\n      // where is /path/to/node_modules/foo/node_modules/bar\n      // for package \"bar\", but we need it to be just\n      // /path/to/node_modules/foo\n      var nmReg = new RegExp(\"\\\\\" + path.sep + \"node_modules\\\\\" + path.sep)\n      where = where.split(nmReg)\n      where.pop()\n      where = where.join(path.sep + \"node_modules\" + path.sep)\n      remove.push.apply(remove, others)\n\n      return npm.commands.install(where, what, cb)\n    }\n\n    // hrm?\n    return cb(new Error(\"danger zone\\n\" + name + \" \" +\n                        regMatch + \" \" + locMatch))\n\n  }, function (er) {\n    if (er) return cb(er)\n    asyncMap(remove, rm, function (er) {\n      if (er) return cb(er)\n      remove.forEach(function (r) {\n        log.info(\"rm\", r)\n      })\n      dedupe_(dir, filter, unavoidable, false, silent, cb)\n    })\n  })\n}\n\nfunction findVersions (npm, summary, cb) {\n  // now, for each item in the summary, try to find the maximum version\n  // that will satisfy all the ranges.  next step is to install it at\n  // the specified location.\n  asyncMap(summary, function (item, cb) {\n    var name = item[0]\n    var data = item[1]\n    var loc = data.loc\n    var locs = data.locs.filter(function (l) {\n      return l !== loc\n    })\n\n    // not actually a dupe, or perhaps all the other copies were\n    // children of a dupe, so this'll maybe be picked up later.\n    if (locs.length === 0) {\n      return cb(null, [])\n    }\n\n    // { <folder>: <version> }\n    var has = data.has\n\n    // the versions that we already have.\n    // if one of these is ok, then prefer to use that.\n    // otherwise, try fetching from the registry.\n    var versions = data.versions\n\n    var ranges = data.ranges\n    mapToRegistry(name, npm.config, function (er, uri, auth) {\n      if (er) return cb(er)\n\n      npm.registry.get(uri, { auth : auth }, next)\n    })\n\n    function next (er, data) {\n      var regVersions = er ? [] : Object.keys(data.versions)\n      var locMatch = bestMatch(versions, ranges)\n      var tag = npm.config.get(\"tag\")\n      var distTag = data[\"dist-tags\"] && data[\"dist-tags\"][tag]\n\n      var regMatch\n      if (distTag && data.versions[distTag] && matches(distTag, ranges)) {\n        regMatch = distTag\n      } else {\n        regMatch = bestMatch(regVersions, ranges)\n      }\n\n      cb(null, [[name, has, loc, locMatch, regMatch, locs]])\n    }\n  }, cb)\n}\n\nfunction matches (version, ranges) {\n  return !ranges.some(function (r) {\n    return !semver.satisfies(version, r, true)\n  })\n}\n\nfunction bestMatch (versions, ranges) {\n  return versions.filter(function (v) {\n    return matches(v, ranges)\n  }).sort(semver.compareLoose).pop()\n}\n\n\nfunction readInstalled (dir, counter, parent, cb) {\n  var pkg, children, realpath\n\n  fs.realpath(dir, function (er, rp) {\n    realpath = rp\n    next()\n  })\n\n  readJson(path.resolve(dir, \"package.json\"), function (er, data) {\n    if (er && er.code !== \"ENOENT\" && er.code !== \"ENOTDIR\") return cb(er)\n    if (er) return cb() // not a package, probably.\n    counter[data.name] = counter[data.name] || 0\n    counter[data.name]++\n    pkg =\n      { _id: data._id\n      , name: data.name\n      , version: data.version\n      , dependencies: data.dependencies || {}\n      , optionalDependencies: data.optionalDependencies || {}\n      , devDependencies: data.devDependencies || {}\n      , bundledDependencies: data.bundledDependencies || []\n      , path: dir\n      , realPath: dir\n      , children: {}\n      , parent: parent\n      , family: Object.create(parent ? parent.family : null)\n      , unavoidable: false\n      , duplicate: false\n      }\n    if (parent) {\n      parent.children[data.name] = pkg\n      parent.family[data.name] = pkg\n    }\n    next()\n  })\n\n  fs.readdir(path.resolve(dir, \"node_modules\"), function (er, c) {\n    children = children || [] // error is ok, just means no children.\n    // check if there are scoped packages.\n    asyncMap(c || [], function (child, cb) {\n      if (child.indexOf('@') === 0) {\n        fs.readdir(path.resolve(dir, \"node_modules\", child), function (er, scopedChildren) {\n          // error is ok, just means no children.\n          (scopedChildren || []).forEach(function (sc) {\n            children.push(path.join(child, sc))\n          })\n          cb()\n        })\n      } else {\n        children.push(child)\n        cb()\n      }\n    }, function (er) {\n      if (er) return cb(er)\n      children = children.filter(function (p) {\n        return !p.match(/^[\\._-]/)\n      })\n      next();\n    });\n  })\n\n  function next () {\n    if (!children || !pkg || !realpath) return\n\n    // ignore devDependencies.  Just leave them where they are.\n    children = children.filter(function (c) {\n      return !pkg.devDependencies.hasOwnProperty(c)\n    })\n\n    pkg.realPath = realpath\n    if (pkg.realPath !== pkg.path) children = []\n    var d = path.resolve(dir, \"node_modules\")\n    asyncMap(children, function (child, cb) {\n      readInstalled(path.resolve(d, child), counter, pkg, cb)\n    }, function (er) {\n      cb(er, pkg, counter)\n    })\n  }\n}\n\nfunction whoDepends (pkg) {\n  var start = pkg.parent || pkg\n  return whoDepends_(pkg, [], start)\n}\n\nfunction whoDepends_ (pkg, who, test) {\n  if (test !== pkg &&\n      test.dependencies[pkg.name] &&\n      test.family[pkg.name] === pkg) {\n    who.push(test)\n  }\n  Object.keys(test.children).forEach(function (n) {\n    whoDepends_(pkg, who, test.children[n])\n  })\n  return who\n}\n"]}